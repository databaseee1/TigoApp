<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Halaman Pesan</title>





<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore,
    collection,
    query,
    orderBy,
    onSnapshot,
    addDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // ---------- Firebase ----------
  const firebaseConfig = {
    apiKey: "AIzaSy....",
    authDomain: "users-96dc5.firebaseapp.com",
    projectId: "users-96dc5",
    storageBucket: "users-96dc5.appspot.com",
    messagingSenderId: "483322415863",
    appId: "1:483322415863:web:xxxxxx"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ---------- Ambil target user dari URL ----------
  const params = new URLSearchParams(window.location.search);
  const userId = params.get("user") || "DefaultUser"; // contoh fallback
  const titleEl = document.querySelector(".header .title");
  if (titleEl) titleEl.textContent = userId; // update judul header

  // ---------- DOM refs ----------
  const chatBox = document.getElementById("chatBox");          // <div class="chat-box" id="chatBox"></div>
  const inputEl = document.querySelector(".input-bar input");   // input pesan
  const sendBtn = document.querySelector(".input-bar .send");   // tombol kirim

  // ---------- Ref & Query Firestore ----------
  const messagesRef = collection(db, "chats", userId, "messages");
  const q = query(messagesRef, orderBy("time", "asc"));

  // ---------- Listener realtime ----------
  onSnapshot(q, (snapshot) => {
    if (!chatBox) return;
    chatBox.innerHTML = "";
    snapshot.forEach((docSnap) => {
      const data = docSnap.data() || {};
      const msgDiv = document.createElement("div");
      const isMe = data.sender === 'Saya';
      msgDiv.className = `msg ${isMe ? "right" : "left"}`;
      msgDiv.innerHTML = `
        <img src="img/${isMe ? "user2" : "user1"}.jpg" alt="avatar">
        <div class="bubble"></div>
      `;
      msgDiv.querySelector(".bubble").textContent = data.text ?? "";
      chatBox.appendChild(msgDiv);
    });
    // auto scroll ke bawah
    chatBox.scrollTop = chatBox.scrollHeight;
  });

  // ---------- Kirim pesan ----------
  if (sendBtn) {
    sendBtn.addEventListener("click", async () => {
      const text = (inputEl?.value || "").trim();
      if (!text) return;
      try {
        await addDoc(messagesRef, {
          sender: "Saya",
          text,
          time: serverTimestamp()
        });
        if (inputEl) inputEl.value = "";
      } catch (e) {
        console.error("Gagal kirim pesan:", e);
      }
    });
  }

  // ---------- (Opsional) Seed data pertama kali ----------
  // Jalankan SEKALI lalu comment agar tidak dobel:
  // async function seedOnce() {
  //   await addDoc(messagesRef, { sender: userId, text: "cara daftarnya gimana", time: serverTimestamp() });
  // }
  // seedOnce();
</script>








  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 15px;
      border-bottom: 1px solid #ddd;
      background: #fff;
      position: sticky;
      top: 0;
    }
    .header .back { font-size: 20px; cursor: pointer; }
    .header .title { font-weight: bold; }
    .header .menu { font-size: 20px; cursor: pointer; }

    /* Chat area */
    .chat-box {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      background: #fafafa;
    }
    .timestamp {
      text-align: center;
      font-size: 12px;
      color: #999;
      margin: 15px 0;
    }
    .msg {
      display: flex;
      margin-bottom: 10px;
      align-items: flex-end;
    }
    .msg.left { flex-direction: row; }
    .msg.right { flex-direction: row-reverse; }
    .msg img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      margin: 0 8px;
    }
    .bubble {
      max-width: 70%;
      padding: 10px 14px;
      border-radius: 18px;
      font-size: 14px;
      line-height: 1.4;
    }
    .left .bubble {
      background: #eee;
      border-top-left-radius: 0;
    }
    .right .bubble {
      background: #8a2be2;
      color: #fff;
      border-top-right-radius: 0;
    }

    /* Input bar */
    .input-bar {
      display: flex;
      align-items: center;
      padding: 8px 10px;
      border-top: 1px solid #ddd;
      background: #fff;
    }
    .input-bar input {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 20px;
      background: #f1f1f1;
      margin: 0 8px;
    }
    .icon {
      font-size: 20px;
      margin: 0 6px;
      cursor: pointer;
    }
    .send {
      background: #8a2be2;
      color: #fff;
      padding: 10px 12px;
      border-radius: 50%;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="back">&#8592;</div>
    <div class="title">hrz</div>
    <div class="menu">&#8942;</div>
  </div>

  <!-- Chat Area -->
  <div class="chat-box">
    <div class="timestamp">2025-08-13 02:02</div>
    <div class="msg left">
      <img src="img/user1.jpg" alt="avatar">
      <div class="bubble">cara daftarnya gimana</div>
    </div>

    <div class="timestamp">2025-08-13 11:47</div>
    <div class="msg right">
      <img src="img/user2.jpg" alt="avatar">
      <div class="bubble">udah berapa lama emang main apk ini kok gatau ?</div>
    </div>

    <div class="timestamp">2025-09-01 07:44</div>
    <div class="msg left">
      <img src="img/user1.jpg" alt="avatar">
      <div class="bubble">yuk vcs</div>
    </div>

    <div class="msg right">
      <img src="img/user2.jpg" alt="avatar">
      <div class="bubble">punya mata untuk baca</div>
    </div>

    <div class="msg left">
      <img src="img/user1.jpg" alt="avatar">
      <div class="bubble">yaela ka ribet</div>
    </div>

    <div class="msg right">
      <img src="img/user2.jpg" alt="avatar">
      <div class="bubble">ribet bagi org bodoh</div>
    </div>
  </div>




<!-- Chat Area -->
<div class="chat-box" id="chatBox"></div>

<!-- Input Bar -->
<div class="input-bar">
  <div class="icon">üòä</div>
  <div class="icon">üñºÔ∏è</div>
  <input type="text" id="msgInput" placeholder="Tulis pesan...">
  <div class="icon">üéÅ</div>
  <div class="send" id="sendBtn">&#10148;</div>
</div>





</body>
</html>
